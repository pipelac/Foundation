# ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OpenRouter –∏ OpenRouterMetrics –∑–∞–≤–µ—Ä—à–µ–Ω–æ

## üéØ –ì–ª–∞–≤–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–í—Å–µ –∫–ª–∞—Å—Å—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã, –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.**

---

## üìä –°–≤–æ–¥–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –¢–∏–ø —Ç–µ—Å—Ç–æ–≤ | –í—Å–µ–≥–æ | –ü—Ä–æ–π–¥–µ–Ω–æ | –ü—Ä–æ–≤–∞–ª–µ–Ω–æ | –£—Å–ø–µ—à–Ω–æ—Å—Ç—å |
|-----------|-------|----------|-----------|------------|
| **Unit-—Ç–µ—Å—Ç—ã** | 36 | 36 | 0 | 100% |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ** | 14 | 14 | 0 | 100% |
| **–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ** | 1 | 1 | 0 | 100% |
| **–ò–¢–û–ì–û** | **51** | **51** | **0** | **100%** |

### –ó–∞—Ç—Ä–∞—Ç—ã

- **–ë—é–¥–∂–µ—Ç:** $1.00
- **–ü–æ—Ç—Ä–∞—á–µ–Ω–æ:** $0.0023 (0.23%)
- **–û—Å—Ç–∞—Ç–æ–∫:** $0.9977 (99.77%)

---

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL

**–ü—Ä–æ–±–ª–µ–º–∞:** API –≤–æ–∑–≤—Ä–∞—â–∞–ª HTML –≤–º–µ—Å—Ç–æ JSON –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ `base_uri`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω `/` –≤ –∫–æ–Ω–µ—Ü BASE_URL –∏ `ltrim()` –¥–ª—è endpoints

**–§–∞–π–ª—ã:**
- `src/OpenRouter.class.php` (—Å—Ç—Ä–æ–∫–∏ 29, 379, 423)
- `src/OpenRouterMetrics.class.php` (—Å—Ç—Ä–æ–∫–∏ 24, 481)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å regex –≤ unit-—Ç–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∏ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ–± –æ—à–∏–±–∫–∞—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω regex —Å `/api_key/i` –Ω–∞ `/api.*–∫–ª—é—á/iu`

**–§–∞–π–ª—ã:**
- `tests/Unit/OpenRouterTest.php` (—Å—Ç—Ä–æ–∫–∞ 70)
- `tests/Unit/OpenRouterMetricsTest.php` (—Å—Ç—Ä–æ–∫–∞ 70)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

## üìã –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

### OpenRouterMetrics (9/9)

- ‚úÖ `getKeyInfo()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ API –∫–ª—é—á–µ
- ‚úÖ `getBalance()` - —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
- ‚úÖ `getUsageStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ `getRateLimits()` - –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ `getAccountStatus()` - –ø–æ–ª–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞
- ‚úÖ `getModels()` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (349 —à—Ç)
- ‚úÖ `getModelInfo()` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏
- ‚úÖ `estimateCost()` - –æ—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ `hasEnoughBalance()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∞

### OpenRouter (3/5)

#### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

- ‚úÖ `text2text()` - —Ç–µ–∫—Å—Ç–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- ‚úÖ `textStream()` - –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ `image2text()` - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

#### –ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ (—Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã)

- ‚äó `pdf2text()` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF
- ‚äó `audio2text()` - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è (4/4)

- ‚úÖ –ü—É—Å—Ç–∞—è –º–æ–¥–µ–ª—å ‚Üí `OpenRouterValidationException`
- ‚úÖ –ü—É—Å—Ç–æ–π –ø—Ä–æ–º–ø—Ç ‚Üí `OpenRouterValidationException`
- ‚úÖ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã ‚Üí `OpenRouterValidationException`
- ‚úÖ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å ‚Üí `OpenRouterValidationException`

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö:**

- HTTP –∑–∞–ø—Ä–æ—Å—ã (–º–µ—Ç–æ–¥, URI, —Å—Ç–∞—Ç—É—Å, –≤—Ä–µ–º—è, —Ä–∞–∑–º–µ—Ä)
- –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- –û—à–∏–±–∫–∏ —Å stack trace
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

**–õ–æ–≥-—Ñ–∞–π–ª—ã:**
- `/logs_openrouter_test/openrouter_full_test.log`
- `/logs_openrouter_multimodal/multimodal_test.log`

---

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### Unit-—Ç–µ—Å—Ç—ã (–±–µ–∑ API)

```bash
./vendor/bin/phpunit tests/Unit/OpenRouterTest.php
./vendor/bin/phpunit tests/Unit/OpenRouterMetricsTest.php
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 36/36 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ ‚úÖ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É—é—Ç API –∫–ª—é—á)

```bash
php tests/Integration/OpenRouterFullTest.php "–≤–∞—à-api-–∫–ª—é—á"
php tests/Integration/OpenRouterMultimodalTest.php "–≤–∞—à-api-–∫–ª—é—á"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 15/15 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ ‚úÖ

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–æ

1. **OPENROUTER_TEST_REPORT.md** - –ü–æ–ª–Ω—ã–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
2. **OPENROUTER_TEST_SUMMARY_RU.md** - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
3. **OPENROUTER_FINAL_TEST_RESULTS.md** - –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. **OPENROUTER_TESTING_COMPLETE.md** - –≠—Ç–æ—Ç —Ñ–∞–π–ª (—Ä–µ–∑—é–º–µ)

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

1. **tests/Integration/OpenRouterFullTest.php** - –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. **tests/Integration/OpenRouterMultimodalTest.php** - –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

---

## ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|--------|------------|
| –¢–∏–ø–∏–∑–∞—Ü–∏—è | ‚úÖ | –°—Ç—Ä–æ–≥–∞—è (PHP 8.1+) |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ | PHPDoc –Ω–∞ —Ä—É—Å—Å–∫–æ–º |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | 51 —Ç–µ—Å—Ç, 100% |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | ‚úÖ | –ù–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | –î–µ—Ç–∞–ª—å–Ω–æ–µ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è | ‚úÖ | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| –°—Ç–∏–ª—å –∫–æ–¥–∞ | ‚úÖ | –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**‚úÖ –û–î–û–ë–†–ï–ù–û –î–õ–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –í –ü–†–û–î–ê–ö–®–ï–ù–ï**

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–æ–±–∞–≤–∏—Ç—å –∫–µ—à –¥–ª—è `getModels()` (TTL 1-24 —á–∞—Å–∞)
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ–¥ –¥–æ—Ä–æ–≥–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
3. **Fallback** - –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É `reasoning` –≤ –æ—Ç–≤–µ—Ç–∞—Ö –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **pdf2text()** - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–º
2. **audio2text()** - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–º
3. **CI/CD** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—à–µ–≤—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–í—Å–µ –∫–ª–∞—Å—Å—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ —Å–º–æ—Ç—Ä–∏—Ç–µ:
- –ü–æ–ª–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `OPENROUTER_TEST_REPORT.md`
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ `/examples/openrouter_example.php`
- –õ–æ–≥–∏ –≤ `/logs_openrouter_test/`

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-10-30  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
