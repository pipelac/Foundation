# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è OpenRouter –∏ OpenRouterMetrics

## üéâ –ò—Ç–æ–≥–∏

**–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ: 15/15 (100%)**

- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã OpenRouterMetrics —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã OpenRouter —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–≤–∫–ª—é—á–∞—è –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- ‚úÖ –ù–∞–π–¥–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 2 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è)
**–ü—Ä–æ–±–ª–µ–º–∞:** API –≤–æ–∑–≤—Ä–∞—â–∞–ª HTML –≤–º–µ—Å—Ç–æ JSON –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ base_uri  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω —Å–ª—ç—à –≤ –∫–æ–Ω–µ—Ü BASE_URL –∏ ltrim –¥–ª—è endpoints  
**–§–∞–π–ª—ã:** OpenRouter.class.php (—Å—Ç—Ä–æ–∫–∏ 29, 379, 423), OpenRouterMetrics.class.php (—Å—Ç—Ä–æ–∫–∏ 24, 481)

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç –æ—Å–æ–±—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ gpt-3.5-turbo –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

## üìä –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

### OpenRouterMetrics (9 –º–µ—Ç–æ–¥–æ–≤)
| –ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|----------|
| `getKeyInfo()` | ‚úÖ | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ API –∫–ª—é—á–µ |
| `getBalance()` | ‚úÖ | –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å |
| `getUsageStats()` | ‚úÖ | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| `getRateLimits()` | ‚úÖ | –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `getAccountStatus()` | ‚úÖ | –ü–æ–ª–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞ |
| `getModels()` | ‚úÖ | –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π (349 —à—Ç) |
| `getModelInfo()` | ‚úÖ | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª–∏ |
| `estimateCost()` | ‚úÖ | –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ |
| `hasEnoughBalance()` | ‚úÖ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ |

### OpenRouter (3 –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–∞)
| –ú–µ—Ç–æ–¥ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|----------|
| `text2text()` | ‚úÖ | –¢–µ–∫—Å—Ç–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è |
| `textStream()` | ‚úÖ | –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ |
| `image2text()` | ‚úÖ | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* –ú–µ—Ç–æ–¥—ã `pdf2text()` –∏ `audio2text()` —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é.

### –í–∞–ª–∏–¥–∞—Ü–∏—è (4 —Ç–µ—Å—Ç–∞)
| –¢–µ—Å—Ç | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|--------|-----------|
| –ü—É—Å—Ç–∞—è –º–æ–¥–µ–ª—å | ‚úÖ | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ OpenRouterValidationException |
| –ü—É—Å—Ç–æ–π –ø—Ä–æ–º–ø—Ç | ‚úÖ | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ OpenRouterValidationException |
| –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã | ‚úÖ | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ OpenRouterValidationException |
| –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å | ‚úÖ | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ OpenRouterValidationException |

## üí∞ –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–õ–∏–º–∏—Ç:** $1.00
- **–ü–æ—Ç—Ä–∞—á–µ–Ω–æ:** $0.0023 (~0.23% –ª–∏–º–∏—Ç–∞)
- **–û—Å—Ç–∞—Ç–æ–∫:** $0.9977
- **–ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** 0.23%

**–†–∞–∑–±–∏–≤–∫–∞:**
- –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (text2text, textStream, –º–µ—Ç—Ä–∏–∫–∏): $0.00003
- –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã (image2text): $0.00227

**–í—ã–≤–æ–¥:** –¢–µ—Å—Ç—ã —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã –∏ –æ—Å—Ç–∞–≤–ª—è—é—Ç –±–æ–ª–µ–µ 99% –ª–∏–º–∏—Ç–∞

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–±—ã—Ç–∏–π:
- ‚úÖ HTTP –∑–∞–ø—Ä–æ—Å—ã (–º–µ—Ç–æ–¥, URI, –∫–æ–¥, –≤—Ä–µ–º—è, —Ä–∞–∑–º–µ—Ä)
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- ‚úÖ –û—à–∏–±–∫–∏ —Å stack trace
- ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:
```
2025-10-30T19:22:20+00:00 INFO HTTP –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω [POST chat/completions] –∫–æ–¥ 200 {
    "method":"POST",
    "uri":"chat/completions",
    "status_code":200,
    "duration":0.925,
    "body_size":532,
    "content_type":"application/json"
}
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É—é—Ç API –∫–ª—é—á)
php tests/Integration/OpenRouterFullTest.php "sk-or-v1-–≤–∞—à-–∫–ª—é—á"

# Unit-—Ç–µ—Å—Ç—ã (–±–µ–∑ API –≤—ã–∑–æ–≤–æ–≤)
./vendor/bin/phpunit tests/Unit/OpenRouterTest.php
./vendor/bin/phpunit tests/Unit/OpenRouterMetricsTest.php
```

## üìÅ –§–∞–π–ª—ã

- **–ò—Å—Ö–æ–¥–Ω–∏–∫–∏:** `/src/OpenRouter.class.php`, `/src/OpenRouterMetrics.class.php`
- **–¢–µ—Å—Ç—ã:** `/tests/Unit/`, `/tests/Integration/OpenRouterFullTest.php`
- **–õ–æ–≥–∏:** `/logs_openrouter_test/`
- **–û—Ç—á–µ—Ç—ã:** `/OPENROUTER_TEST_REPORT.md`, `/OPENROUTER_TEST_SUMMARY_RU.md`

## ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

**–ö–ª–∞—Å—Å—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.**

–í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö.
