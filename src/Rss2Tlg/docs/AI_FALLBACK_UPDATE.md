# AI Analysis ‚Äî Fallback Models Update

## ‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å fallback –º–æ–¥–µ–ª—è–º–∏

**–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è –≤ config/rss2tlg_stress_test.json:**
```json
{
  "ai_analysis": {
    "enabled": true,
    "models": [
      "deepseek/deepseek-chat-v3.1:free",
      "qwen/qwen3-235b-a22b:free",
      "z-ai/glm-4.5-air:free",
      "deepseek/deepseek-r1-0528-qwen3-8b:free",
      "deepseek/deepseek-r1-0528:free"
    ],
    "timeout": 60,
    "retries": 2,
    "retry_delay_ms": 1000
  }
}
```

**–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:**
```json
{
  "feeds": [
    {
      "id": 1,
      "ai_models": null  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ ai_analysis.models
    },
    {
      "id": 2,
      "ai_models": [
        "deepseek/deepseek-chat-v3.1:free",
        "qwen/qwen3-235b-a22b:free"
      ]
    }
  ]
}
```

### 2. –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ analyzeWithFallback()

```php
$analysisService->analyzeWithFallback(
    $item,           // –î–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏
    'INoT_v1',       // ID –ø—Ä–æ–º–ø—Ç–∞
    $models,         // –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π (null = –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
    $options         // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
);
```

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. –ü—Ä–æ–±—É–µ—Ç –ø–µ—Ä–≤—É—é –º–æ–¥–µ–ª—å –∏–∑ —Å–ø–∏—Å–∫–∞
2. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é
3. –î–µ–ª–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (retry_delay_ms)
4. –õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é –ø–æ–ø—ã—Ç–∫—É
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —É—Å–ø–µ—Ö–µ

### 3. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```php
$metrics = $analysisService->getMetrics();
// [
//     'fallback_used' => 12,         // –ù–æ–≤–æ–µ: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ fallback
//     'model_attempts' => [          // –ù–æ–≤–æ–µ: –ø–æ–ø—ã—Ç–∫–∏ –ø–æ –º–æ–¥–µ–ª—è–º
//         'deepseek/deepseek-chat-v3.1:free' => 100,
//         'qwen/qwen3-235b-a22b:free' => 12,
//     ]
// ]
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä

`examples/rss2tlg/ai_analysis_demo.php` —Ç–µ–ø–µ—Ä—å:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `analyzeWithFallback()`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –º–æ–¥–µ–ª—è–º

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** ‚Äî –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è
2. **–≠–∫–æ–Ω–æ–º–∏—è** ‚Äî –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
3. **–ì–∏–±–∫–æ—Å—Ç—å** ‚Äî —Ä–∞–∑–Ω—ã–µ —Å–ø–∏—Å–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
4. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –º–æ–¥–µ–ª–µ–π

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–î–æ–±–∞–≤—å—Ç–µ —Å–µ–∫—Ü–∏—é `ai_analysis` –≤ –≤–∞—à –∫–æ–Ω—Ñ–∏–≥:
```bash
nano config/rss2tlg_stress_test.json
```

### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ analyzeWithFallback

```php
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
$analysis = $analysisService->analyzeWithFallback(
    $item,
    'INoT_v1',
    null  // null = –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
);
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–º–æ

```bash
php examples/rss2tlg/ai_analysis_demo.php
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```php
$metrics = $analysisService->getMetrics();

echo "Fallback –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π: {$metrics['fallback_used']}\n";
echo "–ü–æ–ø—ã—Ç–∫–∏ –ø–æ –º–æ–¥–µ–ª—è–º:\n";
foreach ($metrics['model_attempts'] as $model => $attempts) {
    echo "  - {$model}: {$attempts}\n";
}
```

### SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

```sql
SELECT 
    model_used,
    COUNT(*) as count,
    AVG(processing_time_ms) as avg_time
FROM rss2tlg_ai_analysis
WHERE analysis_status = 'success'
GROUP BY model_used;
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –î–ª—è production

```json
{
  "ai_analysis": {
    "models": [
      "deepseek/deepseek-chat-v3.1:free",
      "qwen/qwen3-235b-a22b:free",
      "deepseek/deepseek-chat"
    ],
    "timeout": 60,
    "retries": 2,
    "retry_delay_ms": 1000
  }
}
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- –ü–µ—Ä–≤—ã–µ 2 –º–æ–¥–µ–ª–∏: –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ (–¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏)
- –ü–æ—Å–ª–µ–¥–Ω—è—è –º–æ–¥–µ–ª—å: –ø–ª–∞—Ç–Ω–∞—è (–∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑–µ—Ä–≤)

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```json
{
  "ai_analysis": {
    "models": [
      "deepseek/deepseek-chat-v3.1:free"
    ],
    "timeout": 30,
    "retries": 1,
    "retry_delay_ms": 500
  }
}
```

## üîß –°–æ–∑–¥–∞–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ —Ñ–∞–π–ª–æ–≤

1. ‚úÖ `config/rss2tlg_stress_test.json` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è `ai_analysis`
2. ‚úÖ `src/Rss2Tlg/AIAnalysisService.php` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `analyzeWithFallback()`
3. ‚úÖ `examples/rss2tlg/ai_analysis_demo.php` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è fallback
4. ‚úÖ `src/Rss2Tlg/AI_FALLBACK_MODELS.md` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (3500+ —Å—Ç—Ä–æ–∫)
5. ‚úÖ `AI_FALLBACK_UPDATE.md` ‚Äî —ç—Ç–æ—Ç —Ñ–∞–π–ª (–∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ö—Ä–∞—Ç–∫–∞—è:** `AI_FALLBACK_UPDATE.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
- **–ü–æ–ª–Ω–∞—è:** `src/Rss2Tlg/AI_FALLBACK_MODELS.md`
- **–û—Å–Ω–æ–≤–Ω–∞—è:** `src/Rss2Tlg/AI_ANALYSIS_README.md`

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ú–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤:
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã

---

**–î–∞—Ç–∞:** 2024-11-04  
**–í–µ—Ä—Å–∏—è:** 1.1.0  
**–ê–≤—Ç–æ—Ä:** AI Analysis Module for Rss2Tlg
