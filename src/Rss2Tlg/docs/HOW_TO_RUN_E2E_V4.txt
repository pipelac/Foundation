═══════════════════════════════════════════════════════════════════
 КАК ЗАПУСТИТЬ E2E ТЕСТИРОВАНИЕ RSS2TLG V4
═══════════════════════════════════════════════════════════════════

📋 ПРЕДВАРИТЕЛЬНЫЕ ТРЕБОВАНИЯ:
  - Docker установлен
  - PHP 8.1+ установлен
  - Composer dependencies установлены (autoload.php)
  - Telegram bot token и channel готовы
  - OpenRouter API key готов

═══════════════════════════════════════════════════════════════════
 ШАГ 1: ЗАПУСК MariaDB (30 сек)
═══════════════════════════════════════════════════════════════════

docker run -d --name rss2tlg_mariadb_v4 \
  -e MYSQL_ROOT_PASSWORD=testpass123 \
  -e MYSQL_DATABASE=rss2tlg_test \
  -e MYSQL_USER=rss2tlg_user \
  -e MYSQL_PASSWORD=testpass123 \
  -p 3308:3306 \
  mariadb:11.3.2 \
  --character-set-server=utf8mb4 \
  --collation-server=utf8mb4_unicode_ci

# Подождать готовности
sleep 30

# Проверить статус
docker ps | grep rss2tlg_mariadb

═══════════════════════════════════════════════════════════════════
 ШАГ 2: ЗАПУСК ТЕСТА (3-5 минут)
═══════════════════════════════════════════════════════════════════

cd /home/engine/project
php tests_rss2tlg_e2e_v4.php

# Или с логированием:
php tests_rss2tlg_e2e_v4.php 2>&1 | tee test_output.log

═══════════════════════════════════════════════════════════════════
 ШАГ 3: ПРОВЕРКА РЕЗУЛЬТАТОВ
═══════════════════════════════════════════════════════════════════

# Просмотр отчета
cat tests/E2E_V4_SUMMARY.txt

# Проверка дампов
ls -lh tests/sql/*.csv

# Проверка БД
docker exec rss2tlg_mariadb_v4 mariadb \
  -urss2tlg_user -ptestpass123 rss2tlg_test \
  -e "SELECT COUNT(*) FROM rss2tlg_items;"

═══════════════════════════════════════════════════════════════════
 ШАГ 4: ОЧИСТКА (опционально)
═══════════════════════════════════════════════════════════════════

# Остановить контейнер
docker stop rss2tlg_mariadb_v4

# Удалить контейнер
docker rm rss2tlg_mariadb_v4

# Очистить дампы (ОСТОРОЖНО!)
rm -rf tests/sql/*.csv

═══════════════════════════════════════════════════════════════════
 🎯 ОЖИДАЕМЫЕ РЕЗУЛЬТАТЫ
═══════════════════════════════════════════════════════════════════

✅ ВСЕ ТЕСТЫ ПРОЙДЕНЫ! 🎉
✅ Новостей собрано: 316
✅ AI анализ: 5
✅ Опубликовано: 5
✅ Ошибок: 0

Дампы созданы:
  - rss2tlg_feed_state_v4_*.csv (5 записей)
  - rss2tlg_items_v4_*.csv (316 записей)
  - rss2tlg_ai_analysis_v4_*.csv (5 записей)
  - rss2tlg_publications_v4_*.csv (5 записей)

═══════════════════════════════════════════════════════════════════
 ⚠️  ВОЗМОЖНЫЕ ПРОБЛЕМЫ
═══════════════════════════════════════════════════════════════════

1. MariaDB не запускается:
   - Проверить порт 3308 не занят: netstat -tuln | grep 3308
   - Удалить старый контейнер: docker rm -f rss2tlg_mariadb_v4

2. Тест не может подключиться к БД:
   - Подождать 30 секунд после запуска контейнера
   - Проверить статус: docker logs rss2tlg_mariadb_v4

3. OpenRouter API ошибки:
   - Проверить API key
   - Проверить лимиты на аккаунте

4. Telegram ошибки:
   - Проверить bot token
   - Убедиться что бот добавлен в канал как админ

═══════════════════════════════════════════════════════════════════
 📚 ДОКУМЕНТАЦИЯ
═══════════════════════════════════════════════════════════════════

tests/E2E_V4_README.txt          - Быстрая справка
tests/E2E_V4_SUMMARY.txt         - Итоговый summary
tests/E2E_V4_FINAL_REPORT.md     - Детальный отчет
tests/INDEX_V4.md                - Навигация

═══════════════════════════════════════════════════════════════════
 💡 СОВЕТЫ
═══════════════════════════════════════════════════════════════════

1. Запускайте тест на свежей БД для чистых результатов
2. Следите за уведомлениями в Telegram bot
3. Проверяйте публикации в канале @kompasDaily
4. Сохраняйте дампы для анализа
5. Читайте логи для отладки

═══════════════════════════════════════════════════════════════════

Удачного тестирования! 🚀
