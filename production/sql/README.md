# SQL –°—Ö–µ–º—ã –∏ –ú–∏–≥—Ä–∞—Ü–∏–∏ RSS2TLG

## üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞
- **`init_schema.sql`** - –ü–æ–ª–Ω–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î –¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –í–µ—Ä—Å–∏—è: 2.0 (2025-11-13)
  - –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
  - –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã
  - **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –ë–î**

### –ú–∏–≥—Ä–∞—Ü–∏–∏ (–∞—Ä—Ö–∏–≤)
–§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

- **`migration_openrouter_metrics.sql`** - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –º–µ—Ç—Ä–∏–∫ OpenRouter API
- **`migration_add_en_fields.sql`** - –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–æ–ª—è –¥–ª—è –∫—Ä–æ—Å—Å-—è–∑—ã–∫–æ–≤–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- **`migration_dedup_v2.2.sql`** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- **`migration_dedup_v3.sql`** - –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (preliminary + AI)
- **`migration_add_usage_web.sql`** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è usage_web –≤ –º–µ—Ç—Ä–∏–∫–∏

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ `init_schema.sql` v2.0  
> –ü—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –æ—Ç–¥–µ–ª—å–Ω–æ –Ω–µ –Ω—É–∂–Ω–æ!

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ë–î
```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ë–î –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
mysql -u root -p << EOF
CREATE DATABASE IF NOT EXISTS rss2tlg_production CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER IF NOT EXISTS 'rss2tlg'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON rss2tlg_production.* TO 'rss2tlg'@'localhost';
FLUSH PRIVILEGES;
EOF

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
mysql -u root -p rss2tlg_production < init_schema.sql
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```bash
mysql -u root -p -e "USE rss2tlg_production; SHOW TABLES;"
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### RSS –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
1. **`rss2tlg_feeds`** - –ò—Å—Ç–æ—á–Ω–∏–∫–∏ RSS –ª–µ–Ω—Ç
2. **`rss2tlg_feed_state`** - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (ETag, Last-Modified, backoff)
3. **`rss2tlg_items`** - –ù–æ–≤–æ—Å—Ç–∏ —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

### AI –æ–±—Ä–∞–±–æ—Ç–∫–∞
4. **`rss2tlg_summarization`** - –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è (—Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ –ø–æ–ª—è–º–∏)
5. **`rss2tlg_deduplication`** - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (–¥–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è: preliminary + AI)

### –ü—É–±–ª–∏–∫–∞—Ü–∏—è
6. **`rss2tlg_publications`** - –ñ—É—Ä–Ω–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–π –≤ Telegram

### –ú–µ—Ç—Ä–∏–∫–∏
7. **`openrouter_metrics`** - –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ OpenRouter API

## üîÑ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –í–µ—Ä—Å–∏—è 2.0 (2025-11-13)
‚úÖ **rss2tlg_feed_state**
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `last_error` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–∫–∏

‚úÖ **rss2tlg_summarization**
  - –î–æ–±–∞–≤–ª–µ–Ω—ã –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–æ–ª—è –¥–ª—è –∫—Ä–æ—Å—Å-—è–∑—ã–∫–æ–≤–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:
    - `category_primary_en`, `category_secondary_en`
    - `keywords_en`
    - `dedup_canonical_entities_en`, `dedup_core_event_en`
  - –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω–¥–µ–∫—Å `idx_category_primary_en`

‚úÖ **rss2tlg_deduplication**
  - –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:
    - `preliminary_similarity_score` - –±—ã—Å—Ç—Ä–∞—è –æ—Ü–µ–Ω–∫–∞
    - `preliminary_method` - –º–µ—Ç–æ–¥ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏
    - `ai_analysis_triggered` - —Ñ–ª–∞–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI
  - –ò–Ω–¥–µ–∫—Å—ã `idx_preliminary_score`, `idx_ai_triggered`

‚úÖ **openrouter_metrics**
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `usage_web` - —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–µ–±-–ø–æ–∏—Å–∫–∞
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `final_cost` - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Å–ª–µ —Å–∫–∏–¥–æ–∫

### –í–µ—Ä—Å–∏—è 1.0 (2025-11-11)
- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ production

## üóëÔ∏è –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

–î–∞–º–ø—ã —Ç–∞–±–ª–∏—Ü —É–¥–∞–ª–µ–Ω—ã, —Ç–∞–∫ –∫–∞–∫ —Å—Ö–µ–º–∞ `init_schema.sql` —è–≤–ª—è–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã:
- ~~`openrouter_metrics_dump.sql`~~
- ~~`rss2tlg_deduplication_dump.sql`~~
- ~~`rss2tlg_feed_state_dump.sql`~~
- ~~`rss2tlg_feeds_dump.sql`~~
- ~~`rss2tlg_items_dump.sql`~~
- ~~`rss2tlg_summarization_dump.sql`~~

> üí° **–°–æ–≤–µ—Ç**: –î–ª—è –±—ç–∫–∞–ø–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `mysqldump` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--no-data` –¥–ª—è —Å—Ö–µ–º—ã –∏–ª–∏ –±–µ–∑ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `ENGINE=InnoDB` –∏ `CHARSET=utf8mb4`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON –ø–æ–ª–µ–π –¥–ª—è –≥–∏–±–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Production README](../README.md) - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è production
- [Rss2Tlg Documentation](../../docs/Rss2Tlg/) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
