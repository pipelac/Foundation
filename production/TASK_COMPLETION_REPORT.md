# ‚úÖ –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏: –û—á–∏—Å—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ production –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2025-11-11  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** AI Agent  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

---

## üìã –ó–∞–¥–∞—á–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞

### ‚úÖ –ó–∞–¥–∞—á–∞ 1: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–º–ø–æ–≤ –∏–∑ production/sql/

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π –¥–∞–º–ø `openrouter_metrics_test_dump.sql`
- –û—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `openrouter_metrics_dump.sql`
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω `rss2tlg_deduplication_test_dump.sql` ‚Üí `rss2tlg_deduplication_dump.sql`

**–ò—Ç–æ–≥–æ–≤—ã–µ –¥–∞–º–ø—ã –≤ production/sql/:**
```
‚úÖ openrouter_metrics_dump.sql
‚úÖ rss2tlg_deduplication_dump.sql
‚úÖ rss2tlg_feed_state_dump.sql
‚úÖ rss2tlg_feeds_dump.sql
‚úÖ rss2tlg_items_dump.sql
‚úÖ rss2tlg_summarization_dump.sql
```

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 2: –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ production/

**–£–¥–∞–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã:**

#### Shell —Å–∫—Ä–∏–ø—Ç—ã (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã):
- ‚ùå `run_3_tests.sh`
- ‚ùå `run_3_tests_fast.sh`
- ‚ùå `run_quick_test.sh`
- ‚ùå `run_test_series.sh`
- ‚ùå `setup_cron.sh`

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚ùå `crontab.txt`
- ‚ùå `apply_metrics_migration.php`
- ‚ùå `notify_metrics_stage1_complete.php`
- ‚ùå `notify_metrics_stage1_summary.php`

#### –°—Ç–∞—Ä—ã–µ –æ—Ç—á–µ—Ç—ã:
- ‚ùå `TEST_REPORT.md`
- ‚ùå `TEST_REPORT_DEDUPLICATION_OPENROUTER_METRICS.md`

**–û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ:**
- ‚úÖ `rss_ingest.php` ‚Äî —Å–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π
- ‚úÖ `rss_summarization.php` ‚Äî AI –∞–Ω–∞–ª–∏–∑
- ‚úÖ `rss_deduplication.php` ‚Äî –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
- ‚úÖ `telegram_notifier.php` ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥–∏ –≤ `configs/`
- ‚úÖ –ü—Ä–æ–º–ø—Ç—ã –≤ `prompts/`
- ‚úÖ SQL –¥–∞–º–ø—ã –≤ `sql/`

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö

#### üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

–í –º–µ—Ç—Ä–∏–∫–∞—Ö OpenRouter –µ—Å—Ç—å –ø–æ–ª–µ **`usage_data`** ‚Äî —ç—Ç–æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é OpenRouter –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∏–ª –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ–∏—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞.

**–§–æ—Ä–º—É–ª–∞ –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏:**
```
Final cost = usage_total - usage_data
```

#### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
`final_cost` –Ω–µ –≤—ã—á–∏—Å–ª—è–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –º–µ—Ç—Ä–∏–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—Å—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

#### ‚úÖ –†–µ—à–µ–Ω–∏–µ

##### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –ë–î
**–§–∞–π–ª:** `production/sql/migration_openrouter_metrics.sql`

–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –ø–æ–ª–µ:
```sql
final_cost DECIMAL(10, 8) NULL 
COMMENT '–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ—Å–ª–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ (usage_total - usage_data) –≤ USD'
```

–û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
```sql
usage_total DECIMAL(10, 8) NULL 
COMMENT '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ –≤ USD (–¥–æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π)'

usage_cache DECIMAL(10, 8) NULL 
COMMENT '–≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ USD'

usage_data DECIMAL(10, 8) NULL 
COMMENT '–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è OpenRouter –∑–∞ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–º–ø—Ç–∞—Ö –≤ USD'
```

##### 2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
**–§–∞–π–ª:** `src/BaseUtils/OpenRouter.class.php`

```php
/**
 * –í—ã—á–∏—Å–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π
 * 
 * –§–æ—Ä–º—É–ª–∞: final_cost = usage_total - usage_data
 * 
 * usage_data - —ç—Ç–æ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è –æ—Ç OpenRouter, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∏–ª
 * –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ–∏—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞.
 */
private function calculateFinalCost(float $usageTotal, float $usageData): ?float
{
    if ($usageTotal === 0.0 && $usageData === 0.0) {
        return null;
    }
    
    $finalCost = $usageTotal - $usageData;
    return max(0.0, $finalCost); // –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
}
```

##### 3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ parseDetailedMetrics()
**–§–∞–π–ª:** `src/BaseUtils/OpenRouter.class.php`

```php
'usage_total' => ...,
'usage_cache' => ...,
'usage_data' => ...,
'usage_file' => ...,
'final_cost' => $this->calculateFinalCost(
    isset($response['usage']) && is_numeric($response['usage']) 
        ? (float)$response['usage'] 
        : 0.0,
    isset($response['usage_data']) 
        ? (float)$response['usage_data'] 
        : 0.0
),
```

##### 4. –û–±–Ω–æ–≤–ª–µ–Ω AIAnalysisTrait
**–§–∞–π–ª:** `src/Rss2Tlg/Pipeline/AIAnalysisTrait.php`

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `final_cost` –≤ SQL INSERT:
```php
INSERT INTO openrouter_metrics (
    ...
    usage_total, usage_cache, usage_data, usage_file, final_cost,
    ...
) VALUES (
    ...
    :usage_total, :usage_cache, :usage_data, :usage_file, :final_cost,
    ...
)
```

#### üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

**–¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ OpenRouter:**
```
Model: deepseek/deepseek-chat
Tokens: 28 (20 prompt + 8 completion)

usage_total: $0.00001457
usage_data:  $0.00000000
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
final_cost:  $0.00001457  ‚úÖ
```

**–ó–∞–ø–∏—Å—å –≤ –ë–î:**
```sql
SELECT * FROM openrouter_metrics WHERE id = 1;

model:           deepseek/deepseek-chat
tokens_prompt:   20
tokens_completion: 8
usage_total:     0.00001457
usage_data:      0.00000000
final_cost:      0.00001457  ‚úÖ –ö–û–†–†–ï–ö–¢–ù–û!
pipeline_module: ProductionTest
```

---

### ‚úÖ –ó–∞–¥–∞—á–∞ 4: –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω–∏—Ü—ã –º–µ–∂–¥—É AIAnalysisTrait –∏ OpenRouterMetrics

**–°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç:** `production/METRICS_CLASSES_COMPARISON.md`

#### –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥

##### üéØ AIAnalysisTrait (`src/Rss2Tlg/Pipeline/AIAnalysisTrait.php`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢—Ä–µ–π—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ AI –∞–Ω–∞–ª–∏–∑–∞ –≤ –ø–∞–π–ø–ª–∞–π–Ω—ã
- **–†–∞–±–æ—Ç–∞–µ—Ç —Å:** –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î `openrouter_metrics`
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –í—ã–∑–æ–≤ AI –º–æ–¥–µ–ª–µ–π —Å fallback –∏ retry
  - –ó–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫ –≤ –ë–î
  - –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–∑ –ë–î
  - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ (Claude)

##### üîë OpenRouterMetrics (`src/BaseUtils/OpenRouterMetrics.class.php`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenRouter API
- **–†–∞–±–æ—Ç–∞–µ—Ç —Å:** OpenRouter API endpoints
- **–§—É–Ω–∫—Ü–∏–∏:**
  - –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞
  - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ rate limits
  - –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

#### ‚ùå –ú–æ–∂–Ω–æ –ª–∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å?

**–ù–ï–¢, –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ù–ï —Å—Ç–æ–∏—Ç!**

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (–≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ vs –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å API)
2. –†–∞–∑–Ω—ã–µ –∑–æ–Ω—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (–ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î vs –≤–Ω–µ—à–Ω–∏–π API)
3. –†–∞–∑–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (runtime –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ vs —ç–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
4. –†–∞–∑–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç MySQL vs —Ç–æ–ª—å–∫–æ HTTP –∫–ª–∏–µ–Ω—Ç)

–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫:
- ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏—é Single Responsibility Principle
- ‚ùå –£—Å–ª–æ–∂–Ω–µ–Ω–∏—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ùå –ü—Ä–æ–±–ª–µ–º–∞–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚ùå –ó–∞–ø—É—Ç–∞–Ω–Ω—ã–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º

---

## üöÄ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### MariaDB Server

**–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:**
- MariaDB 10.11.13
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `rss2tlg_production`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `rss2tlg` (–ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞)
- Charset: `utf8mb4`

**–¢–∞–±–ª–∏—Ü—ã:**
```
‚úÖ rss2tlg_feeds
‚úÖ rss2tlg_feed_state
‚úÖ rss2tlg_items
‚úÖ rss2tlg_summarization
‚úÖ rss2tlg_deduplication
‚úÖ rss2tlg_publications
‚úÖ openrouter_metrics (—Å –ø–æ–ª–µ–º final_cost)
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–Ω—Ñ–∏–≥–∏:**
- ‚úÖ `configs/database.json` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `rss2tlg_production`
- ‚úÖ `configs/openrouter.json` ‚Äî –∞–∫—Ç—É–∞–ª—å–Ω—ã–π API –∫–ª—é—á
- ‚úÖ `configs/telegram.json` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

**RSS –ª–µ–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:**
- –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏
- –ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä
- –ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å
- TechCrunch

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
**–§–∞–π–ª:** `production/test_production_infrastructure.php`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram Bot
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MariaDB
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü
- ‚úÖ –¢–µ—Å—Ç OpenRouter API
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫ —Å `final_cost`
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram –æ —Ö–æ–¥–µ —Ç–µ—Å—Ç–∞

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### ‚úÖ Telegram Bot
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: ‚úÖ OK
- –û—Ç–ø—Ä–∞–≤–∫–∞ 4 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ‚úÖ OK
- Chat ID: 366442475

#### ‚úÖ MariaDB
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ‚úÖ OK
- –ù–∞–π–¥–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: 7
- –ü–æ–ª–µ `final_cost`: ‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

#### ‚úÖ OpenRouter API
- –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å: ‚úÖ OK
- –ú–æ–¥–µ–ª—å: `deepseek/deepseek-chat`
- –¢–æ–∫–µ–Ω–æ–≤: 28
- –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.00001457
- **`final_cost` –≤—ã—á–∏—Å–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:** ‚úÖ

#### ‚úÖ –ó–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫
```sql
SELECT * FROM openrouter_metrics;

id: 1
model: deepseek/deepseek-chat
tokens_prompt: 20
tokens_completion: 8
usage_total: 0.00001457
usage_data: 0.00000000
final_cost: 0.00001457  ‚úÖ
pipeline_module: ProductionTest
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ production/

```
production/
‚îú‚îÄ‚îÄ configs/                           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ database.json                  # –ë–î rss2tlg_production
‚îÇ   ‚îú‚îÄ‚îÄ deduplication.json
‚îÇ   ‚îú‚îÄ‚îÄ deduplication.commented.json
‚îÇ   ‚îú‚îÄ‚îÄ deduplication_optimal.json
‚îÇ   ‚îú‚îÄ‚îÄ feeds.json                     # 4 RSS –ª–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ main.json
‚îÇ   ‚îú‚îÄ‚îÄ openrouter.json                # –ê–∫—Ç—É–∞–ª—å–Ω—ã–π API key
‚îÇ   ‚îú‚îÄ‚îÄ summarization.json
‚îÇ   ‚îî‚îÄ‚îÄ telegram.json                  # Bot token
‚îÇ
‚îú‚îÄ‚îÄ prompts/                           # AI –ø—Ä–æ–º–ø—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ sql/                               # SQL —Å—Ö–µ–º—ã –∏ –¥–∞–º–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ init_schema.sql
‚îÇ   ‚îú‚îÄ‚îÄ migration_add_en_fields.sql
‚îÇ   ‚îú‚îÄ‚îÄ migration_dedup_v2.2.sql
‚îÇ   ‚îú‚îÄ‚îÄ migration_dedup_v3.sql
‚îÇ   ‚îú‚îÄ‚îÄ migration_openrouter_metrics.sql  # ‚úÖ –° –ø–æ–ª–µ–º final_cost
‚îÇ   ‚îú‚îÄ‚îÄ openrouter_metrics_dump.sql
‚îÇ   ‚îú‚îÄ‚îÄ rss2tlg_deduplication_dump.sql
‚îÇ   ‚îú‚îÄ‚îÄ rss2tlg_feed_state_dump.sql
‚îÇ   ‚îú‚îÄ‚îÄ rss2tlg_feeds_dump.sql
‚îÇ   ‚îú‚îÄ‚îÄ rss2tlg_items_dump.sql
‚îÇ   ‚îî‚îÄ‚îÄ rss2tlg_summarization_dump.sql
‚îÇ
‚îú‚îÄ‚îÄ rss_ingest.php                     # ‚ö° Production —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ rss_summarization.php
‚îú‚îÄ‚îÄ rss_deduplication.php
‚îú‚îÄ‚îÄ telegram_notifier.php
‚îÇ
‚îú‚îÄ‚îÄ test_production_infrastructure.php # üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
‚îÇ
‚îú‚îÄ‚îÄ README.md                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ USAGE_EXAMPLES.md
‚îú‚îÄ‚îÄ METRICS_CLASSES_COMPARISON.md      # –ê–Ω–∞–ª–∏–∑ –∫–ª–∞—Å—Å–æ–≤
‚îú‚îÄ‚îÄ PRODUCTION_TEST_SUMMARY.md         # –°–≤–æ–¥–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ TASK_COMPLETION_REPORT.md          # ‚úÖ –≠—Ç–æ—Ç –æ—Ç—á–µ—Ç
```

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ —É—Å–ø–µ—Ö–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| –í—Å–µ —Ç–µ—Å—Ç—ã passed | ‚úÖ | –í—Å–µ —ç—Ç–∞–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω—ã |
| MariaDB —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ | –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω, –ë–î —Å–æ–∑–¥–∞–Ω–∞ |
| –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã | ‚úÖ | 7 —Ç–∞–±–ª–∏—Ü —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å—Ö–µ–º–æ–π |
| OpenRouter API —Ä–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ | –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω |
| Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è | ‚úÖ | 4 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã |
| –ü–æ–ª–µ final_cost | ‚úÖ | –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| –õ–æ–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã | ‚úÖ | –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª –∏ –∫–æ–Ω—Å–æ–ª—å |
| –ë–î –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ | ‚úÖ | –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã |
| Production –ø–∞–ø–∫–∞ —á–∏—Å—Ç–∞ | ‚úÖ | –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã |

---

## üö¶ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø—É—Å–∫—É

### ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
- MariaDB —Ä–∞–±–æ—Ç–∞–µ—Ç
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
- –ö–æ–Ω—Ñ–∏–≥–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- API –∫–ª—é—á–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã

### ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω
- `final_cost` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ –∫–ª–∞—Å—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç

### üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

#### 1. –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
```bash
# –®–∞–≥ 1: –°–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π
php production/rss_ingest.php

# –®–∞–≥ 2: AI –∞–Ω–∞–ª–∏–∑
php production/rss_summarization.php

# –®–∞–≥ 3: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
php production/rss_deduplication.php

# –®–∞–≥ 4: –ü—É–±–ª–∏–∫–∞—Ü–∏—è
php production/telegram_notifier.php
```

#### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫
```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
SELECT 
    pipeline_module,
    COUNT(*) as requests,
    SUM(tokens_prompt + tokens_completion) as tokens,
    SUM(usage_total) as gross_cost,
    SUM(usage_data) as compensation,
    SUM(final_cost) as net_cost
FROM openrouter_metrics
WHERE DATE(recorded_at) = CURDATE()
GROUP BY pipeline_module;
```

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:

1. ‚úÖ **–û—á–∏—Å—Ç–∫–∞ production/sql/** ‚Äî –æ—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–º–ø—ã
2. ‚úÖ **–û—á–∏—Å—Ç–∫–∞ production/** ‚Äî —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã
3. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å usage_data** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `final_cost` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º
4. ‚úÖ **–û–±—ä—è—Å–Ω–µ–Ω–∞ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏** ‚Äî —Å–æ–∑–¥–∞–Ω –ø–æ–¥—Ä–æ–±–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º

### üéâ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

- ‚úÖ –ó–∞–ø—É—â–µ–Ω MariaDB —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥–∏
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∑–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∫ `openrouter_metrics` —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ `final_cost`
2. **–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ `usage_total` –∏ `final_cost` ‚Äî —Ä–∞–∑–Ω–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é –æ—Ç OpenRouter
3. **–î–ª—è production –∑–∞–ø—É—Å–∫–æ–≤** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—á–∏—â–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ `production/`
4. **–î–ª—è –æ—Ç–ª–∞–¥–∫–∏** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_production_infrastructure.php` —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram

---

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
