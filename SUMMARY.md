# –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ Http

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: 25
- ‚úÖ –£—Å–ø–µ—à–Ω–æ: 23 (92%)
- ‚ö†Ô∏è –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: 2 (8% - –≤–Ω–µ—à–Ω–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã)

---

## üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### 1. –û—à–∏–±–∫–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤ retry handler
**–§–∞–π–ª:** `src/Http.class.php:416`  
**–¢–∏–ø:** Type Error  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø üî¥

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
// ‚ùå –î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
?RequestException $exception = null
```

–ü–∞—Ä–∞–º–µ—Ç—Ä –∏–º–µ–ª —Ç–∏–ø `RequestException`, –Ω–æ Guzzle –ø–µ—Ä–µ–¥–∞–≤–∞–ª `ConnectException`, –∫–æ—Ç–æ—Ä—ã–π –ù–ï —è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Ç–∏–ø–æ–º `RequestException`. –û–±–∞ –∫–ª–∞—Å—Å–∞ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `TransferException`.

**–†–µ—à–µ–Ω–∏–µ:**
```php
// ‚úÖ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
?\Throwable $exception = null
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Fatal error —É—Å—Ç—Ä–∞–Ω–µ–Ω, retry –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

### 2. –û—à–∏–±–∫–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –≤ –º–µ—Ç–æ–¥–µ logRetry()
**–§–∞–π–ª:** `src/Http.class.php:471`  
**–¢–∏–ø:** Type Error  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø üî¥

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
// ‚ùå –î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
private function logRetry(int $attemptNumber, RequestInterface $request, RequestException $exception): void
```

**–†–µ—à–µ–Ω–∏–µ:**
```php
// ‚úÖ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
private function logRetry(int $attemptNumber, RequestInterface $request, \Throwable $exception): void
{
    // ...
    
    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–æ–¥–∞–º RequestException
    if ($exception instanceof RequestException) {
        $response = $exception->getResponse();
        if ($response !== null) {
            $context['status_code'] = $response->getStatusCode();
        }
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–µ—Ç–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±—ã–µ —Ç–∏–ø—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

---

## ‚ú® –£–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### 1. –£—Å–ø–µ—à–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã
**–£—Ä–æ–≤–µ–Ω—å:** INFO  
**–ü–æ–ª—è:**
- method (GET, POST, etc.)
- uri
- status_code
- duration (—Å–µ–∫—É–Ω–¥—ã)
- body_size (–±–∞–π—Ç—ã)
- content_type

```json
{
  "method": "GET",
  "uri": "https://www.google.com/",
  "status_code": 200,
  "duration": 0.134,
  "body_size": 76638,
  "content_type": "text/html; charset=ISO-8859-1"
}
```

#### 2. HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –æ—à–∏–±–∫–∞–º–∏ (4xx, 5xx)
**–£—Ä–æ–≤–µ–Ω—å:** WARNING  
**–¢–µ –∂–µ –ø–æ–ª—è, —á—Ç–æ –∏ –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

#### 3. –ü–æ—Ç–æ–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
**–£—Ä–æ–≤–µ–Ω—å:** INFO  
**–ü–æ–ª—è:**
- method
- uri
- status_code
- bytes_received
- duration

```json
{
  "method": "GET",
  "uri": "https://www.example.com/",
  "status_code": 200,
  "bytes_received": 513,
  "duration": 0.117
}
```

#### 4. –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (Retry)
**–£—Ä–æ–≤–µ–Ω—å:** WARNING  
**–ü–æ–ª—è:**
- retry_attempt (–Ω–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏)
- method
- uri
- error
- status_code (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

```json
{
  "retry_attempt": 1,
  "method": "GET",
  "uri": "https://httpstat.us/500",
  "error": "cURL error 52: Empty reply from server"
}
```

#### 5. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
**–£—Ä–æ–≤–µ–Ω—å:** ERROR  
**–ü–æ–ª—è:**
- method
- uri
- exception
- code
- duration
- bytes_received (–¥–ª—è –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)

```json
{
  "method": "GET",
  "uri": "https://example.com/",
  "exception": "cURL error 6: Could not resolve host",
  "code": 0,
  "duration": 0.055
}
```

### –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```php
$http = new Http([
    'log_successful_requests' => true, // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é true
], $logger);
```

–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –≤ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

---

## üìà –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

### HTTP –º–µ—Ç–æ–¥—ã
- ‚úÖ GET - —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ POST - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (JSON, form)
- ‚úÖ PUT - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ PATCH - —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- ‚úÖ DELETE - —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ HEAD - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Å—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞ ‚Üí HttpValidationException
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Å—Ç–æ–≥–æ URI ‚Üí HttpValidationException
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ ‚Üí HttpException
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ 4xx/5xx –∫–æ–¥–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (Stream)
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ç–∞–π–º–∞—É—Ç—ã

---

## üéØ –°—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Å–∞

### ‚úÖ –ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£

–ö–ª–∞—Å—Å `Http` –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ –º–µ—Ç–æ–¥—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (`retries = 3`)
2. –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`log_successful_requests = true`)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Ä–æ–≤–Ω–µ–π –ª–æ–≥–æ–≤:
   - WARNING - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏, —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è
   - ERROR - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏, —Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è
4. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ `duration` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìÅ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

1. `test_http_comprehensive.php` - 20 –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
2. `test_http_retry_logging.php` - 5 —Ç–µ—Å—Ç–æ–≤ retry –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
3. `TESTING_REPORT.md` - –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
4. `SUMMARY.md` - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

## üîß –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### src/Http.class.php
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `private bool $logSuccessfulRequests`
2. –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `log_successful_requests`
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ retry handler: `?RequestException` ‚Üí `?\Throwable`
4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ `logRetry()`: `RequestException` ‚Üí `\Throwable`
5. –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (`$startTime`, `$duration`)
6. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `logSuccessfulRequest()` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
7. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `logSuccessfulStreamRequest()` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
8. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `duration` –≤ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
9. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `bytes_received` –≤ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ:** ~105  
**–°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~95  
**–°—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ:** ~10

---

## ‚úÖ –í—ã–≤–æ–¥

–ö–ª–∞—Å—Å `Http` —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω, –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–æ. –ö–ª–∞—Å—Å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)  
**–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)  
**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)  
**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)
