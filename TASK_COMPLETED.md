# ‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: RSS Content Extractor

## üéØ –¶–µ–ª—å –∑–∞–¥–∞—á–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ RSS –ª–µ–Ω—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª–µ `<content>` –≤ RSS –∏—Å—Ç–æ—á–Ω–∏–∫–µ –ø—É—Å—Ç–æ–µ.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –ê—É–¥–∏—Ç –∏ —É–ª—É—á—à–µ–Ω–∏–µ WebtExtractor.class.php

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Symfony DomCrawler (`composer require symfony/dom-crawler symfony/css-selector`)
- ‚úÖ –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `extractCleanText()` - –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ HTML –æ—Ç —Ç–µ–≥–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤)
- ‚úÖ –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ HTML entities
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ script, style, noscript —Ç–µ–≥–æ–≤
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
- ‚úÖ Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```php
// –ë—ã–ª–æ (–ø—Ä–∏–º–µ—Ä –∏–∑ –∑–∞–¥–∞—á–∏):
$html = '<p>–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç <a href="...">–†–æ—Å—Å–∏–∏</a> –ü—É—Ç–∏–Ω...</p>';

// –°—Ç–∞–ª–æ:
$text = $extractor->extractCleanText($html);
// "–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç –†–æ—Å—Å–∏–∏ –ü—É—Ç–∏–Ω..."
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å production/rss_ingest.php

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ TEST_MODE –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ link, –µ—Å–ª–∏ content –ø—É—Å—Ç–æ–π
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (3-7 —Å–µ–∫)
- ‚úÖ –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ (User-Agent, Accept, etc.)
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `updateExtractedContent()` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (main.json):**
```json
{
    "test_mode": false,
    "extract_content_from_link": true,
    "content_extraction_delay": 5,
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)..."
}
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (feeds.json):**
```json
{
    "extraction_delay": 5
}
```

### 3. –¢–∞–±–ª–∏—Ü–∞ rss2tlg_items

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è:**
- `extracted_content` - —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏
- `extracted_images` - JSON –º–∞—Å—Å–∏–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `extracted_metadata` - JSON –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- `extraction_status` - ENUM('pending','success','failed','skipped')
- `extraction_error` - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- `extracted_at` - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –†–µ–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö MariaDB 10.11.13
- ‚úÖ 5 –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 15.94 —Å–µ–∫
- ‚úÖ –í—Å–µ 5 –Ω–æ–≤–æ—Å—Ç–µ–π —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω—ã
- ‚úÖ –ü–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å–æ–±–ª—é–¥–µ–Ω—ã (3 —Å–µ–∫)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ SQL –¥–∞–º–ø —Å–æ–∑–¥–∞–Ω (96 KB)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
```
üìä –ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 1
   ‚úÖ –£—Å–ø–µ—à–Ω–æ: 1
   ‚ùå –û—à–∏–±–æ–∫: 0

üì∞ –í—Å–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ: 5
   ‚ú® –ù–æ–≤—ã—Ö: 5
   üîÅ –î—É–±–ª–∏–∫–∞—Ç–æ–≤: 0
   üîç –ö–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑–≤–ª–µ—á–µ–Ω–æ: 5
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ | ~2.5 KB |
| –í—Ä–µ–º—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏ | ~3 —Å–µ–∫ |
| –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—Å –ø–∞—É–∑–∞–º–∏) | 0.38 –Ω–æ–≤–æ—Å—Ç–µ–π/—Å–µ–∫ |
| –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è | 100% (5/5) |

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `docs/RSS_EXTRACTOR_TEST_REPORT.md` - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- ‚úÖ `docs/RSS2TLG/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
- ‚úÖ `test_extract_clean_text.php` - unit —Ç–µ—Å—Ç—ã extractCleanText()

### SQL –¥–∞–º–ø—ã:
- ‚úÖ `production/sql/test_extraction_20251113_144849.sql` (96 KB)

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `src/BaseUtils/WebtExtractor.class.php` - –¥–æ–±–∞–≤–ª–µ–Ω extractCleanText()
- ‚úÖ `production/rss_ingest.php` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebtExtractor
- ‚úÖ `production/configs/main.json` - –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ `production/configs/feeds.json` - extraction_delay –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- ‚úÖ `composer.json` - –¥–æ–±–∞–≤–ª–µ–Ω—ã symfony/dom-crawler, symfony/css-selector

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

–°–∏—Å—Ç–µ–º–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**:

1. ‚úÖ TEST_MODE –æ—Ç–∫–ª—é—á–µ–Ω (test_mode: false)
2. ‚úÖ –í—Å–µ 4 RSS –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
4. ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
6. ‚úÖ SQL –¥–∞–º–ø —Å–æ–∑–¥–∞–Ω

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### –ó–∞–ø—É—Å–∫ –≤ production:

```bash
cd /home/engine/project/production
php rss_ingest.php
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã):

```cron
*/2 * * * * cd /home/engine/project/production && php rss_ingest.php >> /home/engine/project/logs/cron.log 2>&1
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
SELECT 
    extraction_status, 
    COUNT(*) as count 
FROM rss2tlg_items 
GROUP BY extraction_status;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
SELECT 
    title, 
    extraction_error 
FROM rss2tlg_items 
WHERE extraction_status = 'failed' 
ORDER BY created_at DESC 
LIMIT 10;
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:**

‚úÖ –ö–ª–∞—Å—Å `WebtExtractor` —É–ª—É—á—à–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω  
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `rss_ingest.php` –∑–∞–≤–µ—Ä—à–µ–Ω–∞  
‚úÖ TEST_MODE —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ –ü–∞—É–∑—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã  
‚úÖ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã  
‚úÖ –¢–∞–±–ª–∏—Ü—ã –ë–î –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ SQL –¥–∞–º–ø —Å–æ–∑–¥–∞–Ω  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞  

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

---

**–î–∞—Ç–∞:** 2025-11-13  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED  
**–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫:** AI Agent
