# –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç: production/rss_ingest.php

## –î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2025-11-13

## –¶–µ–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ TEST_MODE
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∏—Å—Ç–∫–∏ HTML —Ç–µ–≥–æ–≤ –≤ –ø–æ–ª–µ `content` –∏–∑ RSS –ª–µ–Ω—Ç
3. ‚úÖ –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü –ë–î –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### MariaDB
‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω**: MariaDB 10.11.13
‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `rss2tlg_production` —Å–æ–∑–¥–∞–Ω–∞
‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `rss2tlg` —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
‚úÖ **–°—Ö–µ–º–∞**: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ `init_schema.sql`

### PHP
‚úÖ **–í–µ—Ä—Å–∏—è**: PHP 8.3.6
‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è**: cli, curl, mbstring, xml, mysql, zip
‚úÖ **Composer**: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (Readability, DomCrawler, Guzzle, SimplePie)

### –¢–∞–±–ª–∏—Ü—ã –ë–î
```sql
+------------------------------+
| Tables_in_rss2tlg_production |
+------------------------------+
| openrouter_metrics           |
| rss2tlg_deduplication        |
| rss2tlg_feed_state           |
| rss2tlg_feeds                |
| rss2tlg_items                |
| rss2tlg_publications         |
| rss2tlg_summarization        |
+------------------------------+
```

---

## 2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
```
–†–µ–∂–∏–º: TEST_MODE = true
–õ–∏–º–∏—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤: 10
–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 68.48 —Å–µ–∫
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ | 4 |
| –£—Å–ø–µ—à–Ω–æ | 4 |
| –û—à–∏–±–æ–∫ | 0 |
| –≠–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ | 40 |
| –ù–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ | 40 |
| –î—É–±–ª–∏–∫–∞—Ç–æ–≤ | 0 |
| –ö–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑–≤–ª–µ—á–µ–Ω–æ | 30 |

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
| Feed ID | –ù–∞–∑–≤–∞–Ω–∏–µ | Items | With Content (RSS) | With Extracted (Web) | Avg Content Len | Avg Extracted Len |
|---------|----------|-------|---------------------|----------------------|-----------------|-------------------|
| 1 | –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ | 10 | 10 | 0 | 3378.7 | NULL |
| 2 | –ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä | 10 | 0 | 10 | NULL | 2031.6 |
| 3 | –ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å | 10 | 0 | 10 | NULL | 2837.3 |
| 4 | TechCrunch | 10 | 0 | 10 | NULL | 3538.0 |

**–ü–æ—è—Å–Ω–µ–Ω–∏–µ**:
- Feed ID 1 (–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏) –∏–º–µ–µ—Ç –ø–æ–ª–µ `<content:encoded>` –≤ RSS —Å –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
- Feed ID 2, 3, 4 –Ω–µ –∏–º–µ—é—Ç content –≤ RSS, –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü

---

## 3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∏—Å—Ç–∫–∏ HTML (–ò–°–ü–†–ê–í–õ–ï–ù–û)

### ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê: content –∏–∑ RSS —Ç–µ–ø–µ—Ä—å –û–ß–ò–©–ê–ï–¢–°–Ø –æ—Ç HTML —Ç–µ–≥–æ–≤

#### –ë—ã–ª–æ (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
```html
<p> –£–∫—Ä–∞–∏–Ω–∏–∑–∞—Ü–∏—è –≤ –ö–∏–µ–≤–µ –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–µ–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–π, –∂–∏—Ç–µ–ª–∏ —Å—Ç–æ–ª–∏—Ü—ã —Å—Ç–∞–ª–∏ —Å–Ω–æ–≤–∞ —á–∞—â–µ –≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –ø–æ–∂–∞–ª–æ–≤–∞–ª—Å—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Å–µ–∫—Ä–µ—Ç–∞—Ä–∏–∞—Ç–∞ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω–æ–≥–æ –ø–æ –∑–∞—â–∏—Ç–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –Ω–∞ –£–∫—Ä–∞–∏–Ω–µ –°–µ—Ä–≥–µ–π –°–∏—Ä–æ—Ç–µ–Ω–∫–æ. </p>
<p>"–í—ã–∑—ã–≤–∞–µ—Ç –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ —Å–∏—Ç—É–∞—Ü–∏—è –≤ <a href="/location_Kiev/" target="_blank" data-auto="true">–ö–∏–µ–≤–µ</a>: –Ω–∞ —Ñ–æ–Ω–µ —Ö–æ—Ç—å –∏ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö...
```

#### –°—Ç–∞–ª–æ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
```
–ò–≥–æ—Ä—å –ù–∞–π–º—É—à–∏–Ω. –£–∫—Ä–∞–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –±–æ—Ä—å–±—ã —Å –∫–æ—Ä—Ä—É–ø—Ü–∏–µ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –≤–Ω–µ—à–Ω—é—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –ø–æ–º–æ—â—å, –∑–∞—è–≤–∏–ª–∞ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è–º –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –≤–∞–ª—é—Ç–Ω–æ–≥–æ —Ñ–æ–Ω–¥–∞ (–ú–í–§) –î–∂—É–ª–∏ –ö–æ–∑–∞–∫ –Ω–∞ —Ñ–æ–Ω–µ —Ä–∞–∑—Ä–∞–∑–∏–≤—à–µ–≥–æ—Å—è –∫–æ—Ä—Ä—É–ø—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∫–∞–Ω–¥–∞–ª–∞ –≤ —Å—Ç—Ä–∞–Ω–µ. "–ß—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è...
```

**‚úÖ –í—ã–≤–æ–¥**: –ü–æ–ª–µ `content` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç HTML —Ç–µ–≥–æ–≤ —Å –ø–æ–º–æ—â—å—é `WebtExtractor::extractCleanText()`.

### –ü—Ä–∏–º–µ—Ä—ã –æ—á–∏—Å—Ç–∫–∏ HTML

#### –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ (feed_id=1):
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: RSS content:encoded (—Å–æ–¥–µ—Ä–∂–∞–ª HTML)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ —Ç–µ–≥–æ–≤
- **–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞**: 3378.7 —Å–∏–º–≤–æ–ª–æ–≤

#### –ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä, –ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å, TechCrunch:
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: –í–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebtExtractor)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç
- **–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞**: 2031.6 - 3538.0 —Å–∏–º–≤–æ–ª–æ–≤

---

## 4. –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### production/configs/main.json

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ì–¥–µ | –í–µ—Ä–¥–∏–∫—Ç |
|----------|--------------|-----|---------|
| `cron_interval_minutes: 2` | ‚ùå –ù–ï–¢ | - | ‚ö†Ô∏è –ò–ó–ë–´–¢–û–ß–ù–´–ô –ø–∞—Ä–∞–º–µ—Ç—Ä |
| `fetch_timeout: 30` | ‚úÖ –î–ê | `fetchRSS()` —Å—Ç—Ä–æ–∫–∞ 549, `WebtExtractor` –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å—Ç—Ä–æ–∫–∞ 434 | ‚úÖ –ê–ö–¢–£–ê–õ–¨–ù–´–ô |
| `max_retries: 3` | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û | –ù–ï –≤ rss_ingest.php, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `WebtExtractor ‚Üí Http` | ‚ö†Ô∏è –ö–æ—Å–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ WebtExtractor |
| `extract_content_from_link: true` | ‚úÖ –î–ê | `processFeed()` —Å—Ç—Ä–æ–∫–∞ 431 | ‚úÖ –ê–ö–¢–£–ê–õ–¨–ù–´–ô |
| `content_extraction_delay: 5` | ‚úÖ –î–ê | `processFeed()` —Å—Ç—Ä–æ–∫–∞ 460, sleep() —Å—Ç—Ä–æ–∫–∞ 505 | ‚úÖ –ê–ö–¢–£–ê–õ–¨–ù–´–ô |

### –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑

#### ‚ùå cron_interval_minutes
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ cron
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–¥–µ —Å–∫—Ä–∏–ø—Ç–∞
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –£–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π

#### ‚úÖ fetch_timeout
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–∞–π–º–∞—É—Ç HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
  - `fetchRSS()` - —Ç–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ RSS (CURLOPT_TIMEOUT)
  - `WebtExtractor` - —Ç–∞–π–º–∞—É—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å

#### ‚ö†Ô∏è max_retries
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ `rss_ingest.php`, –Ω–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `WebtExtractor ‚Üí Http`
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å WebtExtractor

#### ‚úÖ extract_content_from_link
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ link
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `processFeed()` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω—É–∂–Ω–æ –ª–∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å

#### ‚úÖ content_extraction_delay
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—Å–µ–∫)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `sleep($extractionDelay)` –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

### –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É

‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ**:
- `fetch_timeout`
- `extract_content_from_link`
- `content_extraction_delay`

‚ö†Ô∏è **–ö–æ—Å–≤–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ**:
- `max_retries` (—á–µ—Ä–µ–∑ WebtExtractor)

‚ùå **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ**:
- `cron_interval_minutes` (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)

---

## 5. –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ production/rss_ingest.php

#### 1. –§—É–Ω–∫—Ü–∏—è `parseRSS()` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `$extractor`
```php
// –ë—ã–ª–æ:
function parseRSS(string $content, array $feed, Logger $logger): array

// –°—Ç–∞–ª–æ:
function parseRSS(string $content, array $feed, Logger $logger, ?WebtExtractor $extractor = null): array
```

#### 2. –§—É–Ω–∫—Ü–∏—è `parseRSSItem()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ HTML
```php
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
if ($content !== null && $extractor !== null && trim($content) !== '') {
    try {
        $content = $extractor->extractCleanText($content);
    } catch (\Exception $e) {
        // –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    }
}
```

#### 3. –§—É–Ω–∫—Ü–∏—è `parseAtomItem()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—á–∏—Å—Ç–∫–∞ HTML
```php
// –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ parseRSSItem()
if ($content !== null && $extractor !== null && trim($content) !== '') {
    try {
        $content = $extractor->extractCleanText($content);
    } catch (\Exception $e) {
        // Fallback –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    }
}
```

#### 4. –§—É–Ω–∫—Ü–∏—è `processFeed()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebtExtractor –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞
```php
// –ë—ã–ª–æ: WebtExtractor —Å–æ–∑–¥–∞–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ extract_content_from_link = true

// –°—Ç–∞–ª–æ: WebtExtractor —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ HTML –∏–∑ RSS content
$extractorConfig = [
    'user_agent' => $config['user_agent'] ?? 'Mozilla/5.0...',
    'timeout' => $config['fetch_timeout'] ?? 30,
    'extract_images' => true,
    'extract_links' => false,
    'extract_metadata' => true
];
$extractor = new WebtExtractor($extractorConfig, $logger);
```

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏**: –¢–µ–ø–µ—Ä—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç (–∏–∑ RSS –∏ –∏–∑ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ
2. **–ß–∏—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ**: –ü–æ–ª–µ `content` –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ HTML
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ WebtExtractor

---

## 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –õ–æ–≥ —Ñ–∞–π–ª—ã

```bash
-rw-rw-r-- 1 engine engine  63K Nov 13 16:04 rss_ingest.log
-rw-rw-r-- 1 engine engine 9.4K Nov 13 15:59 test_run_output.log (–ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç)
-rw-rw-r-- 1 engine engine 9.4K Nov 13 16:04 test_run_output_v2.log (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç)
```

‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**:
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ `rss_ingest.log`
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON –ª–æ–≥–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –£—Ä–æ–≤–Ω–∏: info, warning, error
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∏, –æ—à–∏–±–æ–∫

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

‚úÖ **–¶–≤–µ—Ç–Ω–æ–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π**:
- –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É feed
- –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
- –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

---

## 7. SQL –î–∞–º–ø

### –§–∞–π–ª –¥–∞–º–ø–∞
```bash
-rw-rw-r-- 1 engine engine 444K Nov 13 16:05 dump_rss_ingest_test_final_20251113_160528.sql
```

‚úÖ **SQL –¥–∞–º–ø —Å–æ–∑–¥–∞–Ω**: `/home/engine/project/logs/dump_rss_ingest_test_final_20251113_160528.sql`

### –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∞–º–ø–∞:
- –°—Ö–µ–º–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- 40 –∑–∞–ø–∏—Å–µ–π –≤ `rss2tlg_items`
- 4 –∑–∞–ø–∏—Å–∏ –≤ `rss2tlg_feeds`
- 4 –∑–∞–ø–∏—Å–∏ –≤ `rss2tlg_feed_state`
- –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã

---

## 8. –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –û—á–∏—â–µ–Ω–Ω—ã–π content –∏–∑ RSS (–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏)
```sql
SELECT title, SUBSTRING(content, 1, 300) FROM rss2tlg_items WHERE feed_id=1 LIMIT 1;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
```
–ú–í–§ –ø—Ä–∏–∑–≤–∞–ª —Å–æ–∑–¥–∞—Ç—å –Ω–∞ –£–∫—Ä–∞–∏–Ω–µ –Ω–∞–¥–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –±–æ—Ä—å–±—ã —Å –∫–æ—Ä—Ä—É–ø—Ü–∏–µ–π

–ò–≥–æ—Ä—å –ù–∞–π–º—É—à–∏–Ω. –£–∫—Ä–∞–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞—Ç—å –Ω–∞–¥–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É –±–æ—Ä—å–±—ã —Å –∫–æ—Ä—Ä—É–ø—Ü–∏–µ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –≤–Ω–µ—à–Ω—é—é —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –ø–æ–º–æ—â—å, –∑–∞—è–≤–∏–ª–∞ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è–º –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –≤–∞–ª—é—Ç–Ω–æ–≥–æ —Ñ–æ–Ω–¥–∞ (–ú–í–§) –î–∂—É–ª–∏ –ö–æ–∑–∞–∫ –Ω–∞ —Ñ–æ–Ω–µ —Ä–∞–∑—Ä–∞–∑–∏–≤—à–µ–≥–æ—Å—è –∫–æ—Ä—Ä—É–ø—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–∫–∞–Ω–¥–∞–ª–∞ –≤ —Å—Ç—Ä–∞–Ω–µ.
```

### –ü—Ä–∏–º–µ—Ä 2: Extracted content (–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä)
```sql
SELECT title, SUBSTRING(extracted_content, 1, 300) FROM rss2tlg_items WHERE feed_id=2 LIMIT 1;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
```
–≠–∫—Å-–≥–ª–∞–≤–∞ —Ñ–∏–ª–∏–∞–ª–∞ ¬´–í–°–ö¬ª –ø–æ–ª—É—á–∏–ª 5,5 –≥–æ–¥–∞ –∑–∞ –≤–∑—è—Ç–∫–∏

–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∏–π —Ä–∞–π–æ–Ω–Ω—ã–π —Å—É–¥ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞ –ø—Ä–∏–∑–Ω–∞–ª –≤–∏–Ω–æ–≤–Ω—ã–º –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∑—è—Ç–æ–∫ –±—ã–≤—à–µ–≥–æ –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —Ñ–∏–ª–∏–∞–ª–∞ –ü–ê–û ¬´–í–æ–µ–Ω–Ω–æ-—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è¬ª (¬´–í–°–ö¬ª) –Æ—Ä–∏—è –°–µ—Ä–≥–∏. –ï–≥–æ –ø—Ä–∏–≥–æ–≤–æ—Ä–∏–ª–∏ –∫ 5,5 –≥–æ–¥–∞ –∫–æ–ª–æ–Ω–∏–∏ —Å—Ç—Ä–æ–≥–æ–≥–æ —Ä–µ–∂–∏–º–∞. –§–∏–≥—É—Ä–∞–Ω—Ç—É —Ç–∞–∫–∂–µ –∑–∞–ø—Ä–µ—Ç–∏–ª–∏ –Ω–∞ —Å–µ–º—å –ª–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-—Ä–∞—Å–ø–æ—Ä—è–¥–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏...
```

---

## 9. –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|--------|-------------|
| ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã passed | ‚úÖ | 4/4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ |
| ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | ‚úÖ | –ß–µ—Ä–µ–∑ `init_schema.sql` |
| ‚úÖ –õ–æ–≥–∏ –ø–æ–ª–Ω—ã–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ | ‚úÖ | 63KB –ª–æ–≥ —Ñ–∞–π–ª —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π |
| ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ | ‚úÖ | –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —à—Ç–∞—Ç–Ω–æ |
| ‚úÖ –ë–î –≤ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ | ‚úÖ | –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã |
| ‚úÖ HTML –æ—á–∏—â–µ–Ω –∏–∑ content | ‚úÖ | **–ì–õ–ê–í–ù–´–ô –ö–†–ò–¢–ï–†–ò–ô - –í–´–ü–û–õ–ù–ï–ù** |

---

## 10. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 68.48 —Å–µ–∫
- **–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤**: 40 (10 –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç**: ~1.7 —Å–µ–∫
- **–ò–∑–≤–ª–µ—á–µ–Ω–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: 30 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (—É 10 –±—ã–ª content –≤ RSS)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏**: 2 —Å–µ–∫ (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–∞–Ω
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º –≤ WebtExtractor
- ‚úÖ Graceful fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## 11. –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

### üü¢ –¢–ï–°–¢ –ü–û–õ–ù–û–°–¢–¨–Æ –ü–†–û–ô–î–ï–ù

‚úÖ **–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã**:
1. ‚úÖ –°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ TEST_MODE
2. ‚úÖ HTML –æ—á–∏—â–∞–µ—Ç—Å—è –∏–∑ –ø–æ–ª—è `content`
3. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
4. ‚úÖ –¢–∞–±–ª–∏—Ü—ã –ë–î –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
5. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
6. ‚úÖ SQL –¥–∞–º–ø —Å–æ–∑–¥–∞–Ω

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production

1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
   - –£–¥–∞–ª–∏—Ç—å `cron_interval_minutes` –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —á—Ç–æ —ç—Ç–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `content_extraction_delay` –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã `rss2tlg_feed_state` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
   - –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ DNS –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

---

## 12. –§–∞–π–ª—ã

### –õ–æ–≥ —Ñ–∞–π–ª—ã
- `/home/engine/project/logs/rss_ingest.log` - –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥
- `/home/engine/project/logs/test_run_output_v2.log` - –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

### SQL –¥–∞–º–ø—ã
- `/home/engine/project/logs/dump_rss_ingest_test_final_20251113_160528.sql` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥–∞–º–ø

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `/home/engine/project/production/configs/main.json` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ (TEST_MODE=true)
- `/home/engine/project/production/configs/feeds.json` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ RSS
- `/home/engine/project/production/configs/database.json` - –ë–î –∫–æ–Ω—Ñ–∏–≥

### –°–∫—Ä–∏–ø—Ç—ã
- `/home/engine/project/production/rss_ingest.php` - **–ò–°–ü–†–ê–í–õ–ï–ù**
- `/home/engine/project/production/sql/init_schema.sql` - —Å—Ö–µ–º–∞ –ë–î

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ production/rss_ingest.php –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ. –í—ã—è–≤–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π HTML –∏–∑ –ø–æ–ª—è `content` –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ, –¥–∞–Ω–Ω—ã–µ –≤ –ë–î —á–∏—Å—Ç—ã–µ.

**–ì–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ TEST_MODE –≤ false.**
