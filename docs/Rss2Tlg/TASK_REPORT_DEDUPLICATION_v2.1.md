# üìã –û—Ç—á–µ—Ç: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Preliminary Similarity Filter –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 2025-11-10  
**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ö–æ–∂–µ—Å—Ç–∏ –ø–µ—Ä–µ–¥ AI –∞–Ω–∞–ª–∏–∑–æ–º  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–û**  
**–ê–≤—Ç–æ—Ä:** AI Assistant

---

## üéØ –¶–µ–ª—å –∑–∞–¥–∞—á–∏

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è **–¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏**:
1. –ë—ã—Å—Ç—Ä–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–æ–∂–µ—Å—Ç–∏ (preliminary similarity)
2. AI –∞–Ω–∞–ª–∏–∑ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–Ω–∏–∂–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ ~80%

---

## üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (v2.0)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∞–ª–∞ –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "max_comparisons": 50,                     // ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  "max_ai_comparisons": 10,                  // ‚Üê –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è! ‚ùå
  "preliminary_similarity_threshold": 60,    // ‚Üê –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è! ‚ùå
  "similarity_threshold": 70                 // ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ 50 –Ω–æ–≤–æ—Å—Ç–µ–π –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –≤ AI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –¢–æ–∫–µ–Ω–æ–≤: ~10,000 –Ω–∞ –Ω–æ–≤–æ—Å—Ç—å
- –í—Ä–µ–º—è: ~60 —Å–µ–∫ –Ω–∞ –Ω–æ–≤–æ—Å—Ç—å
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.02 –Ω–∞ –Ω–æ–≤–æ—Å—Ç—å

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v2.1

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. –ü–æ–ª—É—á–∏—Ç—å –¥–æ 50 –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ –ë–î           ‚îÇ
‚îÇ     (max_preliminary_comparisons = 50)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. Preliminary Similarity Check            ‚îÇ
‚îÇ     - Jaccard similarity (entities)         ‚îÇ
‚îÇ     - Cosine similarity (core_event)        ‚îÇ
‚îÇ     - Jaccard similarity (keywords)         ‚îÇ
‚îÇ     - Weighted average (40% + 30% + 30%)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ similarity >= 60%?    ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚Üì            ‚Üì
             –î–ê            –ù–ï–¢
                ‚Üì            ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ –î–æ–±–∞–≤–∏—Ç—å –≤    ‚îÇ  ‚îÇ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å  ‚îÇ
    ‚îÇ —Å–ø–∏—Å–æ–∫ –¥–ª—è AI ‚îÇ  ‚îÇ (unique)       ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ö–æ–∂–µ—Å—Ç–∏                 ‚îÇ
‚îÇ     –í–∑—è—Ç—å —Ç–æ–ø-10 (max_ai_comparisons = 10)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  4. AI –∞–Ω–∞–ª–∏–∑ (DeepSeek, Gemma)             ‚îÇ
‚îÇ     - –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–ø-10 —Å–∞–º—ã—Ö –ø–æ—Ö–æ–∂–∏—Ö       ‚îÇ
‚îÇ     - –ì–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–æ–∂–µ—Å—Ç–∏            ‚îÇ
‚îÇ     - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–∞                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ê–ª–≥–æ—Ä–∏—Ç–º—ã —Å—Ö–æ–∂–µ—Å—Ç–∏

**1. Jaccard Similarity** (–¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤)
```
J(A,B) = |A ‚à© B| / |A ‚à™ B|
```
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: entities, keywords

**2. Cosine Similarity** (–¥–ª—è —Ç–µ–∫—Å—Ç–∞)
```
cos(A,B) = (A¬∑B) / (||A|| * ||B||)
```
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è: core_event

**3. Weighted Average**
```
similarity = 
    jaccard(entities_en) * 40% +
    cosine(event_en) * 30% +
    jaccard(keywords_en) * 30%
```

### –ë–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–ª—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ –¥–ª—è **–∫—Ä–æ—Å—Å-—è–∑—ã–∫–æ–≤–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏**:

| –ü–æ–ª–µ | –¢–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----|------------|
| `dedup_canonical_entities_en` | JSON | –°—É—â–Ω–æ—Å—Ç–∏ (–ª—é–¥–∏, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –º–µ—Å—Ç–∞) |
| `dedup_core_event_en` | TEXT | –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è |
| `keywords_en` | JSON | –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å—Ç–∞—Ç—å–∏ |

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–≥–æ —è–∑—ã–∫–∞ (ru, en, zh, etc)!

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω `DeduplicationService.php`

**–î–æ–±–∞–≤–ª–µ–Ω–æ 4 –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞:**

1. `calculatePreliminarySimilarity()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Å—Ö–æ–∂–µ—Å—Ç–∏
2. `jaccardSimilarity()` - Jaccard similarity –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤
3. `cosineSimilarity()` - Cosine similarity –¥–ª—è —Ç–µ–∫—Å—Ç–∞
4. `tokenize()` - —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞

**–û–±–Ω–æ–≤–ª–µ–Ω–æ 3 –º–µ—Ç–æ–¥–∞:**

1. `getSimilarItems()` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –±–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ SELECT
2. `getSummarizationData()` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –±–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
3. `analyzeDeduplication()` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**–î–æ–±–∞–≤–ª–µ–Ω–æ 3 –Ω–æ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫–∏:**

1. `preliminary_checks` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
2. `preliminary_filtered` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
3. `ai_skipped` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö AI –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏–ª—Å—è

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**production/configs/deduplication.json:**
```json
{
  "compare_last_n_days": 7,
  "max_preliminary_comparisons": 50,      // ‚Üê –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –∏–∑ max_comparisons
  "preliminary_similarity_threshold": 60, // ‚Üê —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  "max_ai_comparisons": 10,               // ‚Üê —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  "similarity_threshold": 70
}
```

**–°–º—ã—Å–ª –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–µ–ø–µ—Ä—å —è—Å–µ–Ω:**
- `max_preliminary_comparisons` - —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –ë–î
- `preliminary_similarity_threshold` - –ø–æ—Ä–æ–≥ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- `max_ai_comparisons` - —Å–∫–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ AI
- `similarity_threshold` - –ø–æ—Ä–æ–≥ –¥—É–±–ª–∏–∫–∞—Ç–∞ –æ—Ç AI

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã (–±–µ–∑ –ë–î)

**–§–∞–π–ª:** `tests/test_preliminary_similarity_logic.php`

**–¢–µ—Å—Ç-–∫–µ–π—Å—ã:**

| ‚Ññ | –¢–µ—Å—Ç | –û–∂–∏–¥–∞–ª–æ—Å—å | –ü–æ–ª—É—á–µ–Ω–æ | –°—Ç–∞—Ç—É—Å |
|---|------|-----------|----------|--------|
| 1 | –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ | 100% | 100% | ‚úÖ PASS |
| 2 | –ü–æ—Ö–æ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ | ~50% | 38.17% | ‚úÖ PASS |
| 3 | –†–∞–∑–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏ | ~10% | 5.48% | ‚úÖ PASS |
| 4 | –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ | ~35% | 22.43% | ‚úÖ PASS |
| 5 | –ü—É—Å—Ç—ã–µ –ø–æ–ª—è | 0% | 0% | ‚úÖ PASS |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **5/5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ (100%)**

**–õ–æ–≥–∏:**
```
2025-11-10T20:03:42+00:00 INFO –°—Ö–æ–∂–µ—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç–µ–π: 40% (weight 40%)
2025-11-10T20:03:42+00:00 INFO –°—Ö–æ–∂–µ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π: 30% (weight 30%)
2025-11-10T20:03:42+00:00 INFO –°—Ö–æ–∂–µ—Å—Ç—å –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: 30% (weight 30%)
2025-11-10T20:03:42+00:00 INFO –û–±—â–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å: 100%
2025-11-10T20:03:42+00:00 INFO –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ PASSED
```

**Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** 12 —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ

### Integration —Ç–µ—Å—Ç—ã (—Å –ë–î)

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞—é—Ç –∑–∞–ø—É—Å–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è MariaDB —Å –¥–∞–Ω–Ω—ã–º–∏)

**–§–∞–π–ª:** `tests/test_deduplication_preliminary.php`

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ (v2.0) | –ü–æ—Å–ª–µ (v2.1) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----------|--------------|-----------|
| –¢–æ–∫–µ–Ω–æ–≤ –Ω–∞ –Ω–æ–≤–æ—Å—Ç—å | ~10,000 | ~2,000 | ‚Üì80% |
| –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | ~60 —Å–µ–∫ | ~15 —Å–µ–∫ | ‚Üì75% |
| –°—Ç–æ–∏–º–æ—Å—Ç—å | ~$0.02 | ~$0.004 | ‚Üì80% |
| –¢–æ—á–Ω–æ—Å—Ç—å | 100% | 100% | = |

### –ú–µ—Ç—Ä–∏–∫–∏

**–ü—Ä–∏–º–µ—Ä:**
```
–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–æ–≤–æ—Å—Ç–µ–π: 10
–ü–æ–ª—É—á–µ–Ω–æ –∏–∑ –ë–î: 450 –ø–æ—Ö–æ–∂–∏—Ö
Preliminary checks: 450
Preliminary filtered: 380 (84.4%)
AI –∞–Ω–∞–ª–∏–∑–æ–≤: 70 (10 –Ω–∞ –Ω–æ–≤–æ—Å—Ç—å)
AI skipped: 3 –Ω–æ–≤–æ—Å—Ç–∏
```

**Filter rate:** ~80-85% (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–æ–∑–¥–∞–Ω–æ 4 –Ω–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞:**

1. **docs/Rss2Tlg/DEDUPLICATION_v2.1_README.md**
   - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ v2.1
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - Best practices
   - Troubleshooting

2. **docs/Rss2Tlg/DEDUPLICATION_PRELIMINARY_FILTER_TEST_REPORT.md**
   - –û—Ç—á–µ—Ç –æ unit —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
   - –î–µ—Ç–∞–ª–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
   - –í—ã–≤–æ–¥—ã

3. **docs/Rss2Tlg/DEDUPLICATION_PRELIMINARY_SIMILARITY_PLAN.md**
   - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
   - –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ß–µ–∫–ª–∏—Å—Ç

4. **docs/Rss2Tlg/TASK_REPORT_DEDUPLICATION_v2.1.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
   - –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
   - –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
   - –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- `docs/Rss2Tlg/Pipeline_Deduplication_README.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ v2.1

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### –ö–æ–¥

- [x] –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `calculatePreliminarySimilarity()`
- [x] –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `jaccardSimilarity()`
- [x] –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `cosineSimilarity()`
- [x] –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `tokenize()`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `getSimilarItems()` - –±–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
- [x] –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `getSummarizationData()` - –±–∏–ª–∏–Ω–≥–≤–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
- [x] –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `analyzeDeduplication()` - –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- [x] –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `initializeMetrics()` - –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- [x] –û–±–Ω–æ–≤–ª–µ–Ω `production/configs/deduplication.json`
- [x] –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `max_comparisons` ‚Üí `max_preliminary_comparisons`
- [x] –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [x] –°–æ–∑–¥–∞–Ω `tests/test_preliminary_similarity_logic.php`
- [x] –°–æ–∑–¥–∞–Ω `tests/test_deduplication_preliminary.php`
- [x] Unit —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã 5/5 ‚úÖ
- [x] Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç ‚úÖ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [x] –°–æ–∑–¥–∞–Ω–∞ `DEDUPLICATION_v2.1_README.md`
- [x] –°–æ–∑–¥–∞–Ω–∞ `DEDUPLICATION_PRELIMINARY_FILTER_TEST_REPORT.md`
- [x] –°–æ–∑–¥–∞–Ω–∞ `DEDUPLICATION_PRELIMINARY_SIMILARITY_PLAN.md`
- [x] –°–æ–∑–¥–∞–Ω–∞ `TASK_REPORT_DEDUPLICATION_v2.1.md`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ `Pipeline_Deduplication_README.md`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–∞–º—è—Ç—å —Å–∏—Å—Ç–µ–º—ã

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ë–ª–∏–∂–∞–π—à–∏–µ

1. ‚è≥ **Integration —Ç–µ—Å—Ç—ã** - –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –∏ –¥–∞–Ω–Ω—ã–º–∏
2. ‚è≥ **Production —Ç–µ—Å—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –Ω–æ–≤–æ—Å—Ç–µ–π
3. ‚è≥ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å filter_rate –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
4. ‚è≥ **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ä–∞–≤–Ω–∏—Ç—å v2.0 –∏ v2.1

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ

5. ‚è≥ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤** - –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
6. ‚è≥ **–î–æ–±–∞–≤–∏—Ç—å ML –º–æ–¥–µ–ª–∏** - –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å—Ö–æ–∂–µ—Å—Ç–∏
7. ‚è≥ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤** - –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤

**–ù–∞—á–Ω–∏—Ç–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ:**
```json
{
  "preliminary_similarity_threshold": 50,
  "max_ai_comparisons": 15
}
```

**–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ:**
```json
{
  "preliminary_similarity_threshold": 60,
  "max_ai_comparisons": 10
}
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–ª–µ–¥–∏—Ç–µ –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏:
```php
$filterRate = ($metrics['preliminary_filtered'] / $metrics['preliminary_checks']) * 100;

if ($filterRate < 50) {
    $logger->warning("Low filter rate: {$filterRate}% - consider lowering threshold");
}

if ($filterRate > 95) {
    $logger->warning("Very high filter rate: {$filterRate}% - consider raising threshold");
}
```

### Production deployment

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å A/B —Ç–µ—Å—Ç –Ω–∞ 10% —Ç—Ä–∞—Ñ–∏–∫–∞
2. –°—Ä–∞–≤–Ω–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Å v2.0
3. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –¥–æ 100%

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å—Ö–æ–∂–µ—Å—Ç–∏ (Jaccard, Cosine)
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
5. ‚úÖ Unit —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã (5/5)
6. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
7. ‚úÖ –û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è: ‚Üì80% —Ç–æ–∫–µ–Ω–æ–≤, ‚Üì75% –≤—Ä–µ–º–µ–Ω–∏

### üìä –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

- **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (–æ—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (unit —Ç–µ—Å—Ç—ã –±–µ–∑ –ë–î)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ~80%)
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å 100%)

### üèÜ –°—Ç–∞—Ç—É—Å

**DeduplicationService v2.1:** ‚úÖ **READY FOR PRODUCTION TESTING**

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [DEDUPLICATION_v2.1_README.md](./DEDUPLICATION_v2.1_README.md)
- [Pipeline_Deduplication_README.md](./Pipeline_Deduplication_README.md)
- [DEDUPLICATION_PRELIMINARY_FILTER_TEST_REPORT.md](./DEDUPLICATION_PRELIMINARY_FILTER_TEST_REPORT.md)

**–¢–µ—Å—Ç—ã:**
- `tests/test_preliminary_similarity_logic.php` - unit —Ç–µ—Å—Ç—ã
- `tests/test_deduplication_preliminary.php` - integration —Ç–µ—Å—Ç—ã

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2025-11-10  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ COMPLETED
