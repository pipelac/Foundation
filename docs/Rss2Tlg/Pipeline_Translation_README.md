# üåç TranslationService - –ú–æ–¥—É–ª—å –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–æ–≤–æ—Å—Ç–µ–π

**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION READY  
**–î–∞—Ç–∞:** 2025-11-08

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

**TranslationService** - —Ç—Ä–µ—Ç–∏–π —ç—Ç–∞–ø AI Pipeline –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π RSS. –ú–æ–¥—É–ª—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–∞—à–∏–Ω–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –∫—Ä–∞—Ç–∫–∏—Ö —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–π –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ü–µ–ª–µ–≤—ã–µ —è–∑—ã–∫–∏.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã** - –æ–¥–Ω–∞ –Ω–æ–≤–æ—Å—Ç—å ‚Üí N —è–∑—ã–∫–æ–≤
- ‚úÖ **AI-–ø–µ—Ä–µ–≤–æ–¥ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞** - Claude 3.5 Sonnet + fallback –º–æ–¥–µ–ª–∏
- ‚úÖ **–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –æ—Ç 1 –¥–æ 10
- ‚úÖ **Fallback –º–µ—Ö–∞–Ω–∏–∑–º** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- ‚úÖ **Retry logic** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - —Ç–æ–∫–µ–Ω—ã, –≤—Ä–µ–º—è, –º–æ–¥–µ–ª–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–µ—Å—Ç–æ –≤ Pipeline

```
rss2tlg_items               [–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ RSS]
    ‚Üì
rss2tlg_summarization      [–≠—Ç–∞–ø 1: –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è] ‚úÖ
    ‚Üì
rss2tlg_deduplication      [–≠—Ç–∞–ø 2: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è] ‚úÖ
    ‚Üì
rss2tlg_translation        [–≠—Ç–∞–ø 3: –ü–µ—Ä–µ–≤–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)] ‚úÖ –¢–ï–ö–£–©–ò–ô –ú–û–î–£–õ–¨
    ‚Üì
rss2tlg_illustration       [–≠—Ç–∞–ø 4: –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)] ‚è≥
    ‚Üì
rss2tlg_publications       [–ñ—É—Ä–Ω–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–π]
```

### –¢–∞–±–ª–∏—Ü–∞ –ë–î: `rss2tlg_translation`

```sql
CREATE TABLE `rss2tlg_translation` (
    `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
    `item_id` INT UNSIGNED NOT NULL COMMENT 'ID –Ω–æ–≤–æ—Å—Ç–∏',
    `feed_id` INT UNSIGNED NOT NULL COMMENT 'ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞ RSS',
    
    -- –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
    `status` ENUM('pending', 'processing', 'success', 'failed', 'skipped'),
    
    -- –Ø–∑—ã–∫–∏
    `source_language` VARCHAR(10) NOT NULL COMMENT '–ò—Å—Ö–æ–¥–Ω—ã–π —è–∑—ã–∫',
    `target_language` VARCHAR(10) NOT NULL COMMENT '–¶–µ–ª–µ–≤–æ–π —è–∑—ã–∫',
    
    -- –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    `translated_headline` VARCHAR(500) NULL,
    `translated_summary` TEXT NULL,
    
    -- –ö–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞
    `quality_score` TINYINT UNSIGNED NULL COMMENT '–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (1-10)',
    `quality_issues` TEXT NULL COMMENT '–ü—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞',
    
    -- –ú–µ—Ç—Ä–∏–∫–∏
    `model_used` VARCHAR(150) NULL,
    `tokens_used` INT UNSIGNED NULL,
    `processing_time_ms` INT UNSIGNED NULL,
    `retry_count` TINYINT UNSIGNED DEFAULT 0,
    
    -- Timestamps
    `translated_at` DATETIME NULL,
    `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (`id`),
    UNIQUE KEY `idx_item_lang` (`item_id`, `target_language`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** `UNIQUE KEY` –Ω–∞ `(item_id, target_language)` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–¥–∏–Ω –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞–∂–¥—ã–π —è–∑—ã–∫ –¥–ª—è –∫–∞–∂–¥–æ–π –Ω–æ–≤–æ—Å—Ç–∏.

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```php
<?php

use App\Component\MySQL;
use App\Component\OpenRouter;
use App\Component\Logger;
use App\Rss2Tlg\Pipeline\TranslationService;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
$db = new MySQL($dbConfig, $logger);
$openRouter = new OpenRouter($openRouterConfig, $logger);

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TranslationService
$config = [
    'enabled' => true,
    'target_languages' => ['ru', 'uk', 'es'],  // –¶–µ–ª–µ–≤—ã–µ —è–∑—ã–∫–∏
    'models' => [
        'anthropic/claude-3.5-sonnet',  // Primary
        'deepseek/deepseek-chat',       // Fallback
    ],
    'retry_count' => 2,
    'timeout' => 120,
    'fallback_strategy' => 'sequential',  // –∏–ª–∏ 'random'
    'prompt_file' => __DIR__ . '/prompts/translation_prompt.txt',
];

// –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
$service = new TranslationService($db, $openRouter, $config, $logger);

// –ü–µ—Ä–µ–≤–æ–¥ –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏
$itemId = 123;
$success = $service->processItem($itemId);

if ($success) {
    echo "–ù–æ–≤–æ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –≤—Å–µ —è–∑—ã–∫–∏\n";
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
$metrics = $service->getMetrics();
print_r($metrics);
```

### –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```php
// –ü–µ—Ä–µ–≤–æ–¥ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
$itemIds = [123, 124, 125];
$stats = $service->processBatch($itemIds);

echo "–£—Å–ø–µ—à–Ω–æ: {$stats['success']}\n";
echo "–û—à–∏–±–æ–∫: {$stats['failed']}\n";
echo "–ü—Ä–æ–ø—É—â–µ–Ω–æ: {$stats['skipped']}\n";
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∏–∑ –ë–î

```php
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –Ω–æ–≤–æ—Å—Ç–∏
$query = "
    SELECT target_language, translated_headline, translated_summary, quality_score
    FROM rss2tlg_translation
    WHERE item_id = :item_id AND status = 'success'
";
$translations = $db->query($query, ['item_id' => $itemId]);

foreach ($translations as $trans) {
    echo "{$trans['target_language']}: {$trans['translated_headline']}\n";
    echo "–ö–∞—á–µ—Å—Ç–≤–æ: {$trans['quality_score']}/10\n\n";
}
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥—É–ª—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|-----|----------|--------------|
| `enabled` | bool | –í–∫–ª—é—á–µ–Ω –ª–∏ –º–æ–¥—É–ª—å | `true` |
| `target_languages` | array | –°–ø–∏—Å–æ–∫ —Ü–µ–ª–µ–≤—ã—Ö —è–∑—ã–∫–æ–≤ (ISO 639-1) | `[]` |
| `models` | array | –°–ø–∏—Å–æ–∫ AI –º–æ–¥–µ–ª–µ–π –≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ | `[]` |
| `retry_count` | int | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ | `2` |
| `timeout` | int | –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö | `120` |
| `fallback_strategy` | string | –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–µ—Ä–µ–±–æ—Ä–∞ –º–æ–¥–µ–ª–µ–π: `sequential` –∏–ª–∏ `random` | `sequential` |
| `prompt_file` | string | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –ø—Ä–æ–º–ø—Ç–æ–º | –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏

–ú–æ–¥—É–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª—é–±—ã–µ —è–∑—ã–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 639-1:

- `en` - English
- `ru` - –†—É—Å—Å–∫–∏–π
- `uk` - –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞
- `es` - Espa√±ol
- `de` - Deutsch
- `fr` - Fran√ßais
- `it` - Italiano
- `pt` - Portugu√™s
- `pl` - Polski
- `ja` - Êó•Êú¨Ë™û
- `zh` - ‰∏≠Êñá
- –∏ –¥—Ä—É–≥–∏–µ...

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏

#### ‚úÖ –î–ª—è Production

**1. Claude 3.5 Sonnet (anthropic/claude-3.5-sonnet)**
- –ö–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
- –°–∫–æ—Ä–æ—Å—Ç—å: ~3-5 —Å–µ–∫/—è–∑—ã–∫
- –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.003 –∑–∞ 1K tokens input, $0.015 –∑–∞ 1K tokens output
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–∞–∫ primary –º–æ–¥–µ–ª—å

**2. DeepSeek Chat (deepseek/deepseek-chat)**
- –ö–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞: ‚≠ê‚≠ê‚≠ê‚≠ê
- –°–∫–æ—Ä–æ—Å—Ç—å: ~1-2 —Å–µ–∫/—è–∑—ã–∫
- –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.0001 –∑–∞ 1K tokens
- –û—Ç–ª–∏—á–Ω—ã–π fallback –≤–∞—Ä–∏–∞–Ω—Ç

---

## üìä Production —Ç–µ—Å—Ç

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (2025-11-08)

```bash
php tests/Rss2Tlg/production_translation_test.php
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –Ω–æ–≤–æ—Å—Ç–µ–π | 2 |
| –£—Å–ø–µ—à–Ω–æ—Å—Ç—å | 100% |
| –ü–µ—Ä–µ–≤–æ–¥–æ–≤ —Å–æ–∑–¥–∞–Ω–æ | 6 (2 √ó 3 —è–∑—ã–∫–∞) |
| –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ | 9.0/10 |
| –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ | ~5.6 —Å–µ–∫ |
| –¢–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ | ~911 |

**–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–µ —è–∑—ã–∫–∏:**
- ‚úÖ –†—É—Å—Å–∫–∏–π (ru) - 2 –ø–µ—Ä–µ–≤–æ–¥–∞
- ‚úÖ –£–∫—Ä–∞–∏–Ω—Å–∫–∏–π (uk) - 2 –ø–µ—Ä–µ–≤–æ–¥–∞
- ‚úÖ –ò—Å–ø–∞–Ω—Å–∫–∏–π (es) - 2 –ø–µ—Ä–µ–≤–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤:**

| –û—Ä–∏–≥–∏–Ω–∞–ª (en) | –†—É—Å—Å–∫–∏–π (ru) | –ö–∞—á–µ—Å—Ç–≤–æ |
|---------------|--------------|----------|
| Tesla shareholders approve Elon Musk's $1 trillion pay deal | –ê–∫—Ü–∏–æ–Ω–µ—Ä—ã Tesla –æ–¥–æ–±—Ä–∏–ª–∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç –ò–ª–æ–Ω–∞ –ú–∞—Å–∫–∞ –Ω–∞ —Å—É–º–º—É $1 —Ç—Ä–∏–ª–ª–∏–æ–Ω | 9/10 |
| Rightmove shares drop sharply following AI investment announcement | –ê–∫—Ü–∏–∏ Rightmove —Ä–µ–∑–∫–æ —É–ø–∞–ª–∏ –ø–æ—Å–ª–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ–± –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö –≤ –ò–ò | 9/10 |

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   - –ú–æ–¥—É–ª—å –≤–∫–ª—é—á–µ–Ω?
   - –ï—Å—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏?
   - –ü—Ä–æ—à–ª–∞ –ª–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é?

2. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ü–µ–ª–µ–≤–æ–≥–æ —è–∑—ã–∫–∞:**
   - –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –µ—Å–ª–∏ —è–∑—ã–∫ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –ª–∏ —É–∂–µ
   - –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `processing`

3. **–ü–µ—Ä–µ–≤–æ–¥:**
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞
   - –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (source_lang, target_lang, headline, summary)
   - –í—ã–∑–≤–∞—Ç—å AI —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞ (`completed`)
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
   - –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ `success` –∏–ª–∏ `failed`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (—Ç–æ–∫–µ–Ω—ã, –≤—Ä–µ–º—è, –º–æ–¥–µ–ª—å)
   - –ó–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º

**Sequential (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π):**
```
Claude 3.5 (retry 0) ‚Üí Claude 3.5 (retry 1) ‚Üí Claude 3.5 (retry 2)
    ‚Üì fail
DeepSeek (retry 0) ‚Üí DeepSeek (retry 1) ‚Üí DeepSeek (retry 2)
    ‚Üì fail
ERROR: –í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏
```

**Random (—Å–ª—É—á–∞–π–Ω—ã–π):**
```
–ú–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```php
$metrics = $service->getMetrics();

print_r($metrics);
/* –í—ã–≤–æ–¥:
Array
(
    [total_processed] => 5
    [successful] => 5
    [failed] => 0
    [skipped] => 0
    [total_tokens] => 5464
    [total_time_ms] => 33658
    [translations_created] => 15
    [languages_processed] => Array
        (
            [ru] => 5
            [uk] => 5
            [es] => 5
        )
    [model_attempts] => Array
        (
            [anthropic/claude-3.5-sonnet] => 15
            [deepseek/deepseek-chat] => 0
        )
)
*/
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

```sql
-- –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ —è–∑—ã–∫–∞–º
SELECT 
    target_language,
    COUNT(*) as total,
    AVG(quality_score) as avg_quality,
    MIN(quality_score) as min_quality,
    MAX(quality_score) as max_quality
FROM rss2tlg_translation
WHERE status = 'success'
GROUP BY target_language;
```

---

## üõ†Ô∏è Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–µ—Ä–µ–≤–æ–¥ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
2. –ù–æ–≤–æ—Å—Ç—å –Ω–µ –ø—Ä–æ—à–ª–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
3. –Ø–∑—ã–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–ª–µ–≤—ã–º

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏
SELECT * FROM rss2tlg_summarization WHERE item_id = 123;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
SELECT * FROM rss2tlg_deduplication WHERE item_id = 123;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —è–∑—ã–∫
SELECT article_language FROM rss2tlg_summarization WHERE item_id = 123;
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ü–ª–æ—Ö–æ–π –ø—Ä–æ–º–ø—Ç
2. –ù–µ–ø–æ–¥—Ö–æ–¥—è—â–∞—è –º–æ–¥–µ–ª—å
3. –ö–æ—Ä–æ—Ç–∫–∏–π –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–π —Ç–µ–∫—Å—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ `translation_prompt.txt`
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Claude 3.5 Sonnet –≤–º–µ—Å—Ç–æ –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON"

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ú–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON
2. –ú–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ JSON

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `response_format = json_object` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–ø—Ç - –æ–Ω –¥–æ–ª–∂–µ–Ω —á–µ—Ç–∫–æ —Ç—Ä–µ–±–æ–≤–∞—Ç—å JSON
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤

**DEBUG:**
- SQL –∑–∞–ø—Ä–æ—Å—ã
- –ü–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å –º–æ–¥–µ–ª—è–º–∏

**INFO:**
- –£—Å–ø–µ—à–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã
- HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ OpenRouter

**WARNING:**
- –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ AI (—Å retry)
- –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã

**ERROR:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- –í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞

```
2025-11-08T17:52:00+00:00 INFO [TranslationService] –ù–æ–≤–æ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –≤—Å–µ —è–∑—ã–∫–∏ {
    "item_id": 123,
    "languages": ["ru", "uk", "es"],
    "processing_time_ms": 18676
}

2025-11-08T17:52:05+00:00 DEBUG [TranslationService] –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å –º–æ–¥–µ–ª—å—é {
    "item_id": 123,
    "model": "anthropic/claude-3.5-sonnet",
    "target_language": "ru"
}

2025-11-08T17:52:08+00:00 INFO [TranslationService] –ü–µ—Ä–µ–≤–æ–¥ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω {
    "item_id": 123,
    "source_language": "en",
    "target_language": "ru"
}
```

---

## üéØ Best Practices

### 1. –í—ã–±–æ—Ä —è–∑—ã–∫–æ–≤

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω—É–∂–Ω—ã–µ —è–∑—ã–∫–∏
'target_languages' => ['ru', 'uk'],

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å –Ω–∞ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —è–∑—ã–∫–∏
'target_languages' => ['ru', 'uk', 'en', 'de', 'fr', 'es', 'it', ...],
```

### 2. –ü–æ—Ä—è–¥–æ–∫ –º–æ–¥–µ–ª–µ–π

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å ‚Üí –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å
'models' => [
    'anthropic/claude-3.5-sonnet',  // –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
    'deepseek/deepseek-chat',       // –ë—ã—Å—Ç—Ä—ã–π fallback
],

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –±–µ–∑ fallback
'models' => [
    'anthropic/claude-opus-3',
    'openai/gpt-4-turbo',
],
```

### 3. Retry logic

```php
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –£–º–µ—Ä–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤
'retry_count' => 2,  // 3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –º–æ–¥–µ–ª—å

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∏–ª–∏ –º–∞–ª–æ
'retry_count' => 10,  // –°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ
'retry_count' => 0,   // –ù–µ—Ç retry
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞

```php
// –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ
$avgQuality = $db->queryOne("
    SELECT AVG(quality_score) as avg 
    FROM rss2tlg_translation 
    WHERE status = 'success'
        AND created_at > DATE_SUB(NOW(), INTERVAL 7 DAY)
");

if ($avgQuality['avg'] < 7) {
    // –ö–∞—á–µ—Å—Ç–≤–æ —É–ø–∞–ª–æ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏–ª–∏ –º–æ–¥–µ–ª–∏
    $logger->warning('Translation quality dropped', $avgQuality);
}
```

---

## üìö –°–º. —Ç–∞–∫–∂–µ

- [API.md](./API.md) - –ü–æ–ª–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞ –ø–æ API TranslationService
- [Pipeline_Summarization_README.md](./Pipeline_Summarization_README.md) - –≠—Ç–∞–ø 1
- [Pipeline_Deduplication_README.md](./Pipeline_Deduplication_README.md) - –≠—Ç–∞–ø 2
- [ARCHITECTURE_REVIEW.md](./ARCHITECTURE_REVIEW.md) - –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- [INSTALL.md](./INSTALL.md) - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-08
