# –¢–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç: production/rss_ingest.php

## –î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2025-11-13

## –¶–µ–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ TEST_MODE
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∏—Å—Ç–∫–∏ HTML —Ç–µ–≥–æ–≤ –≤ –ø–æ–ª–µ `content` –∏–∑ RSS –ª–µ–Ω—Ç
3. –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü –ë–î –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### MariaDB
‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω**: MariaDB 10.11.13
‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `rss2tlg_production` —Å–æ–∑–¥–∞–Ω–∞
‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `rss2tlg` —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
‚úÖ **–°—Ö–µ–º–∞**: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ `init_schema.sql`

### PHP
‚úÖ **–í–µ—Ä—Å–∏—è**: PHP 8.3.6
‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è**: cli, curl, mbstring, xml, mysql, zip
‚úÖ **Composer**: –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

---

## 2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
```
–†–µ–∂–∏–º: TEST_MODE = true
–õ–∏–º–∏—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤: 10
–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 68.36 —Å–µ–∫
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ | 4 |
| –£—Å–ø–µ—à–Ω–æ | 4 |
| –û—à–∏–±–æ–∫ | 0 |
| –≠–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ | 40 |
| –ù–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ | 40 |
| –î—É–±–ª–∏–∫–∞—Ç–æ–≤ | 0 |
| –ö–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑–≤–ª–µ—á–µ–Ω–æ | 30 |

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
| Feed ID | –ù–∞–∑–≤–∞–Ω–∏–µ | Items | With Content | With Extracted | Avg Extracted Len |
|---------|----------|-------|--------------|----------------|-------------------|
| 1 | –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ | 10 | 10 | 0 | NULL |
| 2 | –ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä | 10 | 0 | 10 | 1969.6 |
| 3 | –ò–Ω—Ç–µ—Ä—Ñ–∞–∫—Å | 10 | 0 | 10 | 2586.6 |
| 4 | TechCrunch | 10 | 0 | 10 | 3645.9 |

---

## 3. –ê–Ω–∞–ª–∏–∑ –æ—á–∏—Å—Ç–∫–∏ HTML

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê: content –∏–∑ RSS –ù–ï –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç HTML —Ç–µ–≥–æ–≤

#### –ü—Ä–∏–º–µ—Ä content –∏–∑ feed_id=1 (–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏):
```html
<p> –£–∫—Ä–∞–∏–Ω–∏–∑–∞—Ü–∏—è –≤ –ö–∏–µ–≤–µ –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–µ–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ–π, –∂–∏—Ç–µ–ª–∏ —Å—Ç–æ–ª–∏—Ü—ã —Å—Ç–∞–ª–∏ —Å–Ω–æ–≤–∞ —á–∞—â–µ –≥–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –ø–æ–∂–∞–ª–æ–≤–∞–ª—Å—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å —Å–µ–∫—Ä–µ—Ç–∞—Ä–∏–∞—Ç–∞ —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω–æ–≥–æ –ø–æ –∑–∞—â–∏—Ç–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –Ω–∞ –£–∫—Ä–∞–∏–Ω–µ –°–µ—Ä–≥–µ–π –°–∏—Ä–æ—Ç–µ–Ω–∫–æ. </p>
<p>"–í—ã–∑—ã–≤–∞–µ—Ç –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ —Å–∏—Ç—É–∞—Ü–∏—è –≤ <a href="/location_Kiev/" target="_blank" data-auto="true">–ö–∏–µ–≤–µ</a>: –Ω–∞ —Ñ–æ–Ω–µ —Ö–æ—Ç—å –∏ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö, –Ω–æ —É–ª—É—á—à–µ–Ω–∏–π (–ø—Ä–æ—Ü–µ—Å—Å–∞ —É–∫—Ä–∞–∏–Ω–∏–∑–∞—Ü–∏–∏ ‚Äì —Ä–µ–¥.) –≤ —Ü–µ–ª–æ–º –ø–æ <a href="/location_Ukraine/
```

**–í—ã–≤–æ–¥**: –ü–æ–ª–µ `content` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î —Å HTML —Ç–µ–≥–∞–º–∏ –∫–∞–∫ –µ—Å—Ç—å –∏–∑ RSS.

#### –ü—Ä–∏–º–µ—Ä extracted_content –∏–∑ feed_id=2 (–ö–æ–º–º–µ—Ä—Å–∞–Ω—Ç—ä):
```
–ü–µ—Ç—Ä–æ–≥—Ä–∞–¥—Å–∫–∏–π —Ä–∞–π–æ–Ω–Ω—ã–π —Å—É–¥ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–∞ –ø—Ä–∏–∑–Ω–∞–ª –≤–∏–Ω–æ–≤–Ω—ã–º –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∑—è—Ç–æ–∫ –±—ã–≤—à–µ–≥–æ –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ —Ñ–∏–ª–∏–∞–ª–∞ –ü–ê–û ¬´–í–æ–µ–Ω–Ω–æ-—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è¬ª (¬´–í–°–ö¬ª) –Æ—Ä–∏—è –°–µ—Ä–≥–∏. –ï–≥–æ –ø—Ä–∏–≥–æ–≤–æ—Ä–∏–ª–∏ –∫ 5,5 –≥–æ–¥–∞ –∫–æ–ª–æ–Ω–∏–∏ —Å—Ç—Ä–æ–≥–æ–≥–æ —Ä–µ–∂–∏–º–∞. –§–∏–≥—É—Ä–∞–Ω—Ç—É —Ç–∞–∫–∂–µ –∑–∞–ø—Ä–µ—Ç–∏–ª–∏ –Ω–∞ —Å–µ–º—å –ª–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ-—Ä–∞—Å–ø–æ—Ä—è–¥–∏—Ç–µ–ª—å–Ω—ã–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏, —Å–æ–æ–±—â–∏–ª–∏ –≤ –ø—Ä–µ—Å—Å-—Å–ª—É–∂–±–µ –≤–æ–µ–Ω–Ω–æ–π –ø—Ä–æ–∫—É—Ä–∞—Ç—É—Ä—ã. –°–µ—Ä–≥–∞ —Ä—É–∫–æ–≤–æ–¥–∏–ª ¬´–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–≥–æ –≤–æ–µ–Ω–Ω–æ–≥–æ –æ–∫—Ä—É–≥–∞¬ª. –ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–æ —Å–ª–µ–¥—Å—Ç–≤–∏–µ, –≤ 2022-2023 –≥–æ–¥–∞—Ö –ø–æ–¥—Å—É–¥–∏–º—ã–π –ø–æ–ª—É—á–∏–ª —Å–µ–º—å –≤–∑—è—Ç–æ–∫...
```

**–í—ã–≤–æ–¥**: –ü–æ–ª–µ `extracted_content` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—á–∏—â–µ–Ω–æ –æ—Ç HTML (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç WebtExtractor::extractCleanText()).

---

## 4. –ê–Ω–∞–ª–∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### production/configs/main.json

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –ì–¥–µ | –í–µ—Ä–¥–∏–∫—Ç |
|----------|--------------|-----|---------|
| `cron_interval_minutes: 2` | ‚ùå –ù–ï–¢ | - | ‚ö†Ô∏è –ò–ó–ë–´–¢–û–ß–ù–´–ô –ø–∞—Ä–∞–º–µ—Ç—Ä |
| `fetch_timeout: 30` | ‚úÖ –î–ê | fetchRSS() —Å—Ç—Ä–æ–∫–∞ 549, WebtExtractor —Å—Ç—Ä–æ–∫–∞ 455 | ‚úÖ –ê–ö–¢–£–ê–õ–¨–ù–´–ô |
| `max_retries: 3` | ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û | –ù–ï –≤ rss_ingest.php, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ WebtExtractor‚ÜíHttp | ‚ö†Ô∏è –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –Ω–∞–ø—Ä—è–º—É—é –≤ —Å–∫—Ä–∏–ø—Ç–µ |
| `extract_content_from_link: true` | ‚úÖ –î–ê | processFeed() —Å—Ç—Ä–æ–∫–∞ 449 | ‚úÖ –ê–ö–¢–£–ê–õ–¨–ù–´–ô |
| `content_extraction_delay: 5` | ‚úÖ –î–ê | processFeed() —Å—Ç—Ä–æ–∫–∞ 464, 505 | ‚úÖ –ê–ö–¢–£–ê–õ–¨–ù–´–ô |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–æ–Ω—Ñ–∏–≥—É:
1. **cron_interval_minutes** - –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–∫—Ä–∏–ø—Ç–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ cron)
2. **max_retries** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Å–≤–µ–Ω–Ω–æ —á–µ—Ä–µ–∑ WebtExtractor, –Ω–æ –Ω–µ –≤ —Å–∞–º–æ–º rss_ingest.php. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
3. –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã.

---

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü –ë–î

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
```
+------------------------------+
| Tables_in_rss2tlg_production |
+------------------------------+
| openrouter_metrics           |
| rss2tlg_deduplication        |
| rss2tlg_feed_state           |
| rss2tlg_feeds                |
| rss2tlg_items                |
| rss2tlg_publications         |
| rss2tlg_summarization        |
+------------------------------+
```

‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
‚úÖ –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
‚úÖ –ò–Ω–¥–µ–∫—Å—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

---

## 6. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥ —Ñ–∞–π–ª: `/home/engine/project/logs/rss_ingest.log`
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥:
‚úÖ –¶–≤–µ—Ç–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

---

## 7. –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê
**–ü–æ–ª–µ `content` –∏–∑ RSS –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –æ—Ç HTML —Ç–µ–≥–æ–≤**

**–ö–æ–¥**: `production/rss_ingest.php`, —Å—Ç—Ä–æ–∫–∞ 685, —Ñ—É–Ω–∫—Ü–∏—è `parseRSSItem()`
```php
return [
    'guid' => (string)($item->guid ?? $item->link),
    'title' => (string)$item->title,
    'link' => (string)$item->link,
    'description' => (string)$item->description,
    'content' => $content,  // ‚ùå –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å HTML —Ç–µ–≥–∞–º–∏
    // ...
];
```

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–∏—Ç—å `WebtExtractor::extractCleanText()` –∫ –ø–æ–ª—é `content` –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.

### ‚ö†Ô∏è –í–¢–û–†–û–°–¢–ï–ü–ï–ù–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø
1. –ü–∞—Ä–∞–º–µ—Ç—Ä `cron_interval_minutes` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
2. –ü–∞—Ä–∞–º–µ—Ç—Ä `max_retries` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ rss_ingest.php

---

## 8. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ—á–∏—Å—Ç–∫—É HTML –∫ –ø–æ–ª—é `content` –∏–∑ RSS
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å SQL –¥–∞–º–ø –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
1. –£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `cron_interval_minutes` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
2. –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –≤ fetchRSS() –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è

---

## –°—Ç–∞—Ç—É—Å
üî¥ **–¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ HTML –≤ –ø–æ–ª–µ `content`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ rss_ingest.php
2. –û—á–∏—Å—Ç–∏—Ç—å –ë–î
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ
4. –°–æ–∑–¥–∞—Ç—å SQL –¥–∞–º–ø
5. –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç—á–µ—Ç
