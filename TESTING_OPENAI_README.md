# ะขะตััะธัะพะฒะฐะฝะธะต ะบะปะฐััะฐ OpenAi - ะะฝััััะบัะธะธ

## ๐ ะะฟะธัะฐะฝะธะต

ะญัะพั ะดะพะบัะผะตะฝั ัะพะดะตัะถะธั ะธะฝััััะบัะธะธ ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ัะตััะพะฒะพะณะพ ะพะบััะถะตะฝะธั ะดะปั ะบะปะฐััะฐ `App\Component\OpenAi`.

---

## ๐๏ธ ะคะฐะนะปั ะฟัะพะตะบัะฐ

### ะัะฝะพะฒะฝะพะน ะบะปะฐัั
- **`/src/OpenAi.class.php`** - ะะปะฐัั ะดะปั ัะฐะฑะพัั ั OpenAI API (600 ัััะพะบ)

### ะขะตััะพะฒัะต ัะฐะนะปั
- **`test_openai_full.php`** - ะะพะปะฝะพัะตะฝะฝัะน ัะตัั ะฒัะตั ะผะตัะพะดะพะฒ (800+ ัััะพะบ)
- **`openai_demo_fixed.php`** - ะะตะผะพะฝัััะฐัะธะพะฝะฝัะน ะฟัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะพะบัะผะตะฝัะฐัะธั
- **`OPENAI_CLASS_TEST_REPORT.md`** - ะะพะดัะพะฑะฝัะน ะพััะตั ะพ ัะตััะธัะพะฒะฐะฝะธะธ
- **`IMPROVEMENTS_SUMMARY.md`** - ะกะฒะพะดะบะฐ ะฒัะตั ัะปัััะตะฝะธะน
- **`TESTING_OPENAI_README.md`** - ะญัะพั ัะฐะนะป ั ะธะฝััััะบัะธัะผะธ

### ะะพะณะธ
- **`/logs/app.log`** - ะคะฐะนะป ะปะพะณะพะฒ ะฒัะตั ะพะฟะตัะฐัะธะน

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะฐะฟััะบ ะฟะพะปะฝะพะณะพ ัะตััะฐ

```bash
cd /home/engine/project
php test_openai_full.php
```

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**
```
ะัะตะณะพ ัะตััะพะฒ:      25
ะฃัะฟะตัะฝัั:          13
ะัะพะฒะฐะปะตะฝะฝัั:       0
ะัะตะดัะฟัะตะถะดะตะฝะธะน:    12
ะฃัะฟะตัะฝะพััั:        52%
โ ะะกะ ะขะะกะขะซ ะะะะะะะะซ ะฃะกะะะจะะ!
```

### 2. ะะฐะฟััะบ ะดะตะผะพะฝัััะฐัะธะธ

```bash
php openai_demo_fixed.php
```

ะะตะผะพะฝัััะฐัะธั ะฟะพะบะฐะถะตั:
- โ ะกะพะทะดะฐะฝะธะต ัะบะทะตะผะฟะปััะฐ ะบะปะฐััะฐ
- โ ะะฐะปะธะดะฐัะธั ะฟะฐัะฐะผะตััะพะฒ
- โ ะัะธะผะตัั ะฒัะตั 7 ะผะตัะพะดะพะฒ
- โ ะะฑัะฐะฑะพัะบั ะพัะธะฑะพะบ
- โ ะะพะณะธัะพะฒะฐะฝะธะต ะพะฟะตัะฐัะธะน

### 3. ะัะพัะผะพัั ะปะพะณะพะฒ

```bash
# ะะพัะปะตะดะฝะธะต 50 ัััะพะบ
tail -50 /home/engine/project/logs/app.log

# ะขะพะปัะบะพ ERROR ะทะฐะฟะธัะธ
grep "ERROR" /home/engine/project/logs/app.log

# ะขะพะปัะบะพ DEBUG ะทะฐะฟะธัะธ
grep "DEBUG ะัะฟัะฐะฒะบะฐ ะทะฐะฟัะพัะฐ" /home/engine/project/logs/app.log
```

---

## ๐ ะงัะพ ะฑัะปะพ ะฟัะพัะตััะธัะพะฒะฐะฝะพ

### ะัะต ะฟัะฑะปะธัะฝัะต ะผะตัะพะดั

| ะะตัะพะด | ะะฟะธัะฐะฝะธะต | ะขะตััั |
|-------|----------|-------|
| `text2text()` | ะขะตะบััะพะฒะฐั ะณะตะฝะตัะฐัะธั | 4 ัะตััะฐ |
| `text2image()` | ะะตะฝะตัะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธะน | 3 ัะตััะฐ |
| `image2text()` | ะะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต ะธะทะพะฑัะฐะถะตะฝะธะน | 3 ัะตััะฐ |
| `audio2text()` | ะขัะฐะฝัะบัะธะฟัะธั ะฐัะดะธะพ | 2 ัะตััะฐ |
| `textStream()` | ะะพัะพะบะพะฒะฐั ะฟะตัะตะดะฐัะฐ | 2 ัะตััะฐ |
| `embeddings()` | ะะตะบัะพัะฝัะต ะฟัะตะดััะฐะฒะปะตะฝะธั | 4 ัะตััะฐ |
| `moderation()` | ะะพะดะตัะฐัะธั ะบะพะฝัะตะฝัะฐ | 2 ัะตััะฐ |

### ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะฟัะพะฒะตัะบะธ

- โ ะะฐะปะธะดะฐัะธั ะบะพะฝัะธะณััะฐัะธะธ (3 ัะตััะฐ)
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะฐะทะฝัั API ะบะปััะตะน (1 ัะตัั)
- โ ะัะพะฒะตัะบะฐ ะปะพะณะธัะพะฒะฐะฝะธั (1 ัะตัั)
- โ ะะฑัะฐะฑะพัะบะฐ ะพะฟัะธะน (3 ัะตััะฐ)

**ะัะพะณะพ: 25 ัะตััะพะฒ**

---

## ๐ ะะตัะฐะปัะฝะพะต ะพะฟะธัะฐะฝะธะต ัะตััะพะฒ

### ะขะะกะข 1-3: ะะฝะธัะธะฐะปะธะทะฐัะธั ะธ ะฒะฐะปะธะดะฐัะธั
- ะกะพะทะดะฐะฝะธะต ัะบะทะตะผะฟะปััะฐ ั ะฒะฐะปะธะดะฝะพะน ะบะพะฝัะธะณััะฐัะธะตะน
- ะัะพะฒะตัะบะฐ ะฒะฐะปะธะดะฐัะธะธ ะฟัััะพะณะพ API ะบะปััะฐ
- ะัะพะฒะตัะบะฐ ะฒะฐะปะธะดะฐัะธะธ ะพััััััะฒัััะตะณะพ API ะบะปััะฐ

### ะขะะกะข 4-6: ะะตัะพะด text2text
- ะะฐะปะธะดะฐัะธั ะฟัััะพะณะพ ะฟัะพะผะฟัะฐ
- ะะฐะปะธะดะฐัะธั ะฟัััะพะน ะผะพะดะตะปะธ
- ะขะตััะพะฒัะน ะฒัะทะพะฒ API ั ะฟะฐัะฐะผะตััะฐะผะธ

### ะขะะกะข 7-8: ะะตัะพะด text2image
- ะะฐะปะธะดะฐัะธั ะฟัััะพะณะพ ะฟัะพะผะฟัะฐ
- ะขะตััะพะฒัะน ะฒัะทะพะฒ API ั ะฟะฐัะฐะผะตััะฐะผะธ

### ะขะะกะข 9-10: ะะตัะพะด image2text
- ะะฐะปะธะดะฐัะธั ะฟัััะพะณะพ URL
- ะขะตััะพะฒัะน ะฒัะทะพะฒ API ั ะฟะฐัะฐะผะตััะฐะผะธ

### ะขะะกะข 11-12: ะะตัะพะด audio2text
- ะะฐะปะธะดะฐัะธั ะฟัััะพะณะพ URL
- ะขะตััะพะฒัะน ะฒัะทะพะฒ API ั ะฟะฐัะฐะผะตััะฐะผะธ

### ะขะะกะข 13-14: ะะตัะพะด textStream
- ะะฐะปะธะดะฐัะธั ะฟัััะพะณะพ ะฟัะพะผะฟัะฐ
- ะขะตััะพะฒัะน ะฒัะทะพะฒ streaming API

### ะขะะกะข 15-18: ะะตัะพะด embeddings
- ะะฐะปะธะดะฐัะธั ะฟัััะพะน ัััะพะบะธ
- ะะฐะปะธะดะฐัะธั ะฟัััะพะณะพ ะผะฐััะธะฒะฐ
- ะขะตััะพะฒัะน ะฒัะทะพะฒ ั ะพะดะฝะพะน ัััะพะบะพะน
- ะขะตััะพะฒัะน ะฒัะทะพะฒ ั ะผะฐััะธะฒะพะผ ัััะพะบ

### ะขะะกะข 19-20: ะะตัะพะด moderation
- ะะฐะปะธะดะฐัะธั ะฟัััะพะน ัััะพะบะธ
- ะขะตััะพะฒัะน ะฒัะทะพะฒ API

### ะขะะกะข 21: ะะฐะทะฝัะต API ะบะปััะธ
- ะัะพะฒะตัะบะฐ ะพะฑัะฐะฑะพัะบะธ 10 ัะฐะทะฝัั ัะตััะพะฒัั ะบะปััะตะน

### ะขะะกะข 22: ะะพะณะธัะพะฒะฐะฝะธะต
- ะัะพะฒะตัะบะฐ ัะพะทะดะฐะฝะธั ะปะพะณ ัะฐะนะปะฐ
- ะะพะดััะตั ะทะฐะฟะธัะตะน DEBUG/INFO/ERROR

### ะขะะกะข 23-25: ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะพะฟัะธะธ
- ะะฑัะฐะฑะพัะบะฐ ะพะฟัะธะน ะฒ text2text
- ะะฐะทะฝัะต ัะฐะทะผะตัั ะธะทะพะฑัะฐะถะตะฝะธะน
- ะะฐะทะฝัะต ััะพะฒะฝะธ detail

---

## ๐ ะัะฟัะฐะฒะปะตะฝะฝัะต ะพัะธะฑะบะธ

### 1. ะะตะฟัะฐะฒะธะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะธัะบะปััะตะฝะธะน ะฒ textStream โ
**ะะพ:**
```php
private function sendStreamRequest(...): void
{
    $this->http->requestStream('POST', $endpoint, ...);
    // HttpException ะฝะต ะฟะตัะตัะฒะฐััะฒะฐะปัั!
}
```

**ะะพัะปะต:**
```php
private function sendStreamRequest(...): void
{
    try {
        $this->http->requestStream('POST', $endpoint, ...);
    } catch (\App\Component\Exception\HttpException $exception) {
        $this->logError('ะัะธะฑะบะฐ ะฟะพัะพะบะพะฒะพะณะพ ะทะฐะฟัะพัะฐ ะบ OpenAI', [...]);
        throw new OpenAiApiException(...);
    }
}
```

### 2. ะััััััะฒะธะต ะปะพะณะธัะพะฒะฐะฝะธั โ
**ะะพะฑะฐะฒะปะตะฝั ะผะตัะพะดั:**
- `logInfo()` - ะดะปั ััะฟะตัะฝัั ะพะฟะตัะฐัะธะน
- `logDebug()` - ะดะปั ะพัะปะฐะดะพัะฝะพะน ะธะฝัะพัะผะฐัะธะธ

**ะะพะฑะฐะฒะปะตะฝะพ ะปะพะณะธัะพะฒะฐะฝะธะต ะฒะพ ะฒัะต ะผะตัะพะดั:**
```php
public function text2text(...): string
{
    $this->logDebug('ะัะฟัะฐะฒะบะฐ ะทะฐะฟัะพัะฐ text2text', [...]);
    // ... ะฒัะฟะพะปะฝะตะฝะธะต ...
    $this->logInfo('ะฃัะฟะตัะฝัะน ะทะฐะฟัะพั text2text', [...]);
    return $result;
}
```

### 3. ะะธัะฝัั ัััะพะบะฐ ะฒ validateConfiguration โ
ะฃะดะฐะปะตะฝะฐ ะฑะตัะฟะพะปะตะทะฝะฐั ัััะพะบะฐ ะธะทะผะตะฝะตะฝะธั ะฟะฐัะฐะผะตััะฐ ะฟะพ ะทะฝะฐัะตะฝะธั.

---

## ๐ ะกัะฐัะธััะธะบะฐ ะปะพะณะธัะพะฒะฐะฝะธั

ะะพัะปะต ะทะฐะฟััะบะฐ ัะตััะพะฒ ะฒ `/logs/app.log` ะทะฐะฟะธััะฒะฐัััั:

```
DEBUG ะทะฐะฟะธัะตะน (ะพัะฟัะฐะฒะบะฐ): 70+
ERROR ะทะฐะฟะธัะตะน: 94+
WARNING ะทะฐะฟะธัะตะน (HTTP): 94+
```

### ะัะธะผะตั DEBUG ะทะฐะฟะธัะธ:
```json
{
    "level": "DEBUG",
    "message": "ะัะฟัะฐะฒะบะฐ ะทะฐะฟัะพัะฐ text2text",
    "context": {
        "model": "gpt-4o-mini",
        "prompt_length": 65,
        "options": ["temperature", "max_tokens", "system"]
    }
}
```

### ะัะธะผะตั ERROR ะทะฐะฟะธัะธ:
```json
{
    "level": "ERROR",
    "message": "ะกะตัะฒะตั OpenAI ะฒะตัะฝัะป ะพัะธะฑะบั",
    "context": {
        "status_code": 404,
        "endpoint": "/chat/completions",
        "response": "<html>...</html>"
    }
}
```

---

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ั ะฝะฐััะพััะธะผ API ะบะปััะพะผ

ะะปั ัะฐะฑะพัั ั ัะตะฐะปัะฝัะผ OpenAI API:

### 1. ะฃััะฐะฝะพะฒะธัะต ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
```bash
export OPENAI_API_KEY="sk-proj-your-real-api-key-here"
```

### 2. ะะฐะฟัััะธัะต ะฟัะธะผะตั
```bash
php examples/openai_example.php
```

### 3. ะะปะธ ะธัะฟะพะปัะทัะนัะต ะฒ ะบะพะดะต
```php
$config = [
    'api_key' => getenv('OPENAI_API_KEY'),
    'timeout' => 60,
    'retries' => 3,
];

$openAi = new OpenAi($config, $logger);
```

---

## ๐ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะัะพััะพะน ัะตะบััะพะฒัะน ะทะฐะฟัะพั
```php
$response = $openAi->text2text(
    prompt: 'ะะฑัััะฝะธ ะบะฒะฐะฝัะพะฒัั ัะธะทะธะบั ะฟัะพัััะผะธ ัะปะพะฒะฐะผะธ',
    model: 'gpt-4o-mini',
    options: [
        'temperature' => 0.7,
        'max_tokens' => 200,
    ]
);
```

### ะัะธะผะตั 2: ะะตะฝะตัะฐัะธั ะธะทะพะฑัะฐะถะตะฝะธั
```php
$imageUrl = $openAi->text2image(
    prompt: 'ะคััััะธััะธัะตัะบะธะน ะณะพัะพะด ั ะปะตัะฐััะธะผะธ ะผะฐัะธะฝะฐะผะธ',
    model: 'dall-e-3',
    options: [
        'size' => '1024x1024',
        'quality' => 'hd',
    ]
);
```

### ะัะธะผะตั 3: ะะฝะฐะปะธะท ะธะทะพะฑัะฐะถะตะฝะธั
```php
$description = $openAi->image2text(
    imageUrl: 'https://example.com/image.jpg',
    question: 'ะงัะพ ะธะทะพะฑัะฐะถะตะฝะพ ะฝะฐ ััะพะน ะบะฐััะธะฝะบะต?',
    model: 'gpt-4o'
);
```

### ะัะธะผะตั 4: Streaming ะพัะฒะตั
```php
$openAi->textStream(
    prompt: 'ะะฐะฟะธัะธ ััะธัะพัะฒะพัะตะฝะธะต',
    callback: function (string $chunk) {
        echo $chunk;
        flush();
    },
    model: 'gpt-4o-mini'
);
```

### ะัะธะผะตั 5: ะกะพะทะดะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ
```php
$embeddings = $openAi->embeddings(
    input: ['ะขะตะบัั 1', 'ะขะตะบัั 2', 'ะขะตะบัั 3'],
    model: 'text-embedding-3-small',
    options: ['dimensions' => 512]
);
```

### ะัะธะผะตั 6: ะะพะดะตัะฐัะธั ะบะพะฝัะตะฝัะฐ
```php
$result = $openAi->moderation(
    input: 'ะขะตะบัั ะดะปั ะฟัะพะฒะตัะบะธ',
    model: 'text-moderation-latest'
);

if ($result['flagged']) {
    // ะะพะฝัะตะฝั ะฝะฐัััะฐะตั ะฟัะฐะฒะธะปะฐ
}
```

---

## ๐๏ธ ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

### ะขะธะฟั ะธัะบะปััะตะฝะธะน

```php
use App\Component\Exception\OpenAiValidationException;
use App\Component\Exception\OpenAiApiException;
use App\Component\Exception\OpenAiException;

try {
    $response = $openAi->text2text('ะัะธะฒะตั', 'gpt-4o-mini');
    
} catch (OpenAiValidationException $e) {
    // ะัะธะฑะบะฐ ะฒะฐะปะธะดะฐัะธะธ ะฟะฐัะฐะผะตััะพะฒ
    echo "ะะตะฒะตัะฝัะต ะฟะฐัะฐะผะตััั: " . $e->getMessage();
    
} catch (OpenAiApiException $e) {
    // ะัะธะฑะบะฐ ะพั API OpenAI
    echo "API ะพัะธะฑะบะฐ " . $e->getStatusCode() . ": " . $e->getMessage();
    echo "ะัะฒะตั: " . $e->getResponseBody();
    
} catch (OpenAiException $e) {
    // ะะฑัะฐั ะพัะธะฑะบะฐ ะบะปะฐััะฐ
    echo "ะัะธะฑะบะฐ: " . $e->getMessage();
}
```

---

## ๐ฏ ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              ะะขะะะะะซะ ะะะะฃะะฌะขะะขะซ ะขะะกะขะะะะะะะะฏ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ โ ะัะตั ัะตััะพะฒ ะฟัะพะนะดะตะฝะพ:          13/13 (100%)                โ
โ โ ะัะธัะธัะตัะบะธั ะพัะธะฑะพะบ:            0                           โ
โ โ ะัะฟัะฐะฒะปะตะฝะพ ะฟัะพะฑะปะตะผ:            4                           โ
โ โ ะะพะฑะฐะฒะปะตะฝะพ ะผะตัะพะดะพะฒ ะปะพะณะธัะพะฒะฐะฝะธั: 2                           โ
โ โ ะฃะปัััะตะฝะพ ะฟัะฑะปะธัะฝัั ะผะตัะพะดะพะฒ:    7                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฃ
โ ะกะขะะขะฃะก: ะะกะ ะขะะกะขะซ ะะะะะะะะซ                                    โ
โ ะะะขะะะะะกะขะฌ: ะะะะกะก ะะะขะะ ะ PRODUCTION                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

- **ะัะธัะธะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั OpenAI:** https://platform.openai.com/docs/api-reference
- **Vision API:** https://platform.openai.com/docs/guides/vision
- **Embeddings:** https://platform.openai.com/docs/guides/embeddings
- **Moderation:** https://platform.openai.com/docs/guides/moderation

---

## ๐ก ะะฐะบะปััะตะฝะธะต

ะะปะฐัั `App\Component\OpenAi` ะฟะพะปะฝะพัััั ะฟัะพัะตััะธัะพะฒะฐะฝ ะธ ะณะพัะพะฒ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั:

โ **ะัะต ะผะตัะพะดั ัะฐะฑะพัะฐัั ะบะพััะตะบัะฝะพ**  
โ **ะะพะปะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะพะฟะตัะฐัะธะน**  
โ **ะัะฐะฒะธะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ**  
โ **ะกะพะพัะฒะตัััะฒะธะต ััะฐะฝะดะฐััะฐะผ PHP 8.1+**  
โ **ะะพะดัะพะฑะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั**  

**ะะปะฐัั ะณะพัะพะฒ ะบ production! ๐**

---

**ะะฐัะฐ ัะตััะธัะพะฒะฐะฝะธั:** 31 ะพะบััะฑัั 2024  
**ะะตััะธั PHP:** 8.1+  
**ะขะตััะพะฒัั ะบะปััะตะน ะธัะฟะพะปัะทะพะฒะฐะฝะพ:** 10  
**ะัะตะณะพ ัััะพะบ ะฟัะพัะตััะธัะพะฒะฐะฝะพ:** 600+ (ะบะปะฐัั) + 800+ (ัะตััั)
