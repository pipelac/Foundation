# üöÄ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ App ID

## üìå –ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã

### 1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ (`cached_tokens = 0`)
**–ü—Ä–∏—á–∏–Ω–∞:** System –∏ user –ø—Ä–æ–º–ø—Ç—ã —Å–º–µ—à–∏–≤–∞–ª–∏—Å—å –≤ –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç  
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ multi-message —Ñ–æ—Ä–º–∞—Ç–∞

### 2. App ID –ø–æ–∫–∞–∑—ã–≤–∞–ª "Unknown"
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ HTTP-Referer –∏ X-Title  
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤ OpenRouter.class.php

---

## ‚ö° –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### 1. OpenRouter.class.php
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏ `HTTP-Referer` –∏ `X-Title`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `chatWithMessages()` –¥–ª—è multi-message —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `cached_tokens` –≤ usage

### 2. AIAnalysisService.php
- ‚úÖ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `chatWithMessages()` –≤–º–µ—Å—Ç–æ `text2textWithMetrics()`
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç system –∏ user —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `app_name` –≤ rss2tlg_e2e_test.json

---

## üîß –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á OpenRouter

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_API_KEY –Ω–∞ –≤–∞—à –∫–ª—é—á
curl -X POST https://openrouter.ai/api/v1/chat/completions \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -H "HTTP-Referer: https://RSS2TLG-E2E-Test" \
  -H "X-Title: RSS2TLG-E2E-Test" \
  -d '{
    "model": "qwen/qwen-2.5-72b-instruct",
    "messages": [
      {"role": "system", "content": "You are a helpful assistant."},
      {"role": "user", "content": "Say hello."}
    ]
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** JSON –æ—Ç–≤–µ—Ç —Å `choices` –∏ `usage`

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 401:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –Ω–∞ https://openrouter.ai/keys
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–ª–∞–Ω—Å > $0 –Ω–∞ https://openrouter.ai/credits

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ API –∫–ª—é—á –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –∫–ª—é—á –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω, –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ:

```json
// src/Rss2Tlg/config/rss2tlg_e2e_test.json
{
  "openrouter": {
    "api_key": "sk-or-v1-YOUR_VALID_KEY_HERE",
    "app_name": "RSS2TLG-E2E-Test",
    ...
  }
}
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –î–í–ê–ñ–î–´

```bash
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∫–µ—à
php tests/Rss2Tlg/tests_rss2tlg_e2e_v5.php

# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10 —Å–µ–∫—É–Ω–¥

# –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à
php tests/Rss2Tlg/tests_rss2tlg_e2e_v5.php
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:
```
üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 0 —Ç–æ–∫–µ–Ω–æ–≤ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å)
üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 0 —Ç–æ–∫–µ–Ω–æ–≤
üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 0 —Ç–æ–∫–µ–Ω–æ–≤
```

–í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫:
```
üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 3200 —Ç–æ–∫–µ–Ω–æ–≤ ‚úÖ
üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 3200 —Ç–æ–∫–µ–Ω–æ–≤ ‚úÖ
üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–æ: 3200 —Ç–æ–∫–µ–Ω–æ–≤ ‚úÖ
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ App ID –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://openrouter.ai/activity
2. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã
3. –í —Å—Ç–æ–ª–±—Ü–µ **App** –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `RSS2TLG-E2E-Test` (–Ω–µ `Unknown`)
4. –í —Å—Ç–æ–ª–±—Ü–µ **Cached Tokens** –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0 –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```
5 –∞–Ω–∞–ª–∏–∑–æ–≤ √ó 3800 —Ç–æ–∫–µ–Ω–æ–≤ = 19,000 prompt tokens
–°—Ç–æ–∏–º–æ—Å—Ç—å: $0.00285
Cached tokens: 0
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```
1-–π –∞–Ω–∞–ª–∏–∑: 3800 —Ç–æ–∫–µ–Ω–æ–≤ (—Å–æ–∑–¥–∞–µ—Ç –∫–µ—à)
2-5 –∞–Ω–∞–ª–∏–∑—ã: 600 —Ç–æ–∫–µ–Ω–æ–≤ –∫–∞–∂–¥—ã–π (–∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–µ—à)
–ò—Ç–æ–≥–æ: 6,200 prompt tokens
–°—Ç–æ–∏–º–æ—Å—Ç—å: $0.00093
Cached tokens: 12,800

üí∞ –≠–∫–æ–Ω–æ–º–∏—è: 67.4% –Ω–∞ prompt tokens!
```

---

## ‚ùì FAQ

### Q: –ü–æ—á–µ–º—É –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞ 401 –æ—à–∏–±–∫–∞?
**A:** API –∫–ª—é—á –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –Ω–∞ https://openrouter.ai/keys –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

### Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?
**A:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–≤–∞–∂–¥—ã –ø–æ–¥—Ä—è–¥. –í–æ –≤—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `cached_tokens > 0` –≤ –≤—ã–≤–æ–¥–µ.

### Q: –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å App ID?
**A:** https://openrouter.ai/activity ‚Üí —Å—Ç–æ–ª–±–µ—Ü "App" ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "RSS2TLG-E2E-Test"

### Q: –ö–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ?
**A:** 
- ‚úÖ Claude 3.5 Sonnet (–ª—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
- ‚úÖ GPT-4 Turbo/GPT-4o
- ‚ö†Ô∏è  Qwen 2.5 72B Instruct (—á–∞—Å—Ç–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
- ‚ö†Ô∏è  DeepSeek V3 (—á–∞—Å—Ç–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)

### Q: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–µ—à?
**A:** 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

---

## üìö –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `src/Rss2Tlg/PROMPT_CACHING_GUIDE.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `tests/Rss2Tlg/CACHING_TEST_REPORT.md` - –æ—Ç—á–µ—Ç –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é
- `CHANGELOG_CACHING_UPDATE.md` - —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚úÖ Checklist

- [x] –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] API –∫–ª—é—á –ø—Ä–æ–≤–µ—Ä–µ–Ω —á–µ—Ä–µ–∑ curl
- [ ] –¢–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω –¥–≤–∞–∂–¥—ã
- [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (cached_tokens > 0)
- [ ] App ID –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-11-07*
