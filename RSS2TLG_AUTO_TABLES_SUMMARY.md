# RSS2TLG: –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ MySQL —Ç–∞–±–ª–∏—Ü –∏ Production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìã –ó–∞–¥–∞—á–∞

1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö MySQL —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î
2. ‚úÖ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Å–µ—Ä–∏—é —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ 5 RSS –ª–µ–Ω—Ç
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å production MySQL
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
5. ‚úÖ –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤ Telegram –∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ Polling
6. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ö–æ–¥–µ —Ç–µ—Å—Ç–æ–≤ –≤ Telegram –±–æ—Ç

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### 1. –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü

#### `ItemRepository.php`
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏ –∏–∑ RSS/Atom –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `rss2tlg_items` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `content_hash` (MD5)
- UNIQUE –∏–Ω–¥–µ–∫—Å –Ω–∞ `content_hash` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –ú–µ—Ç–æ–¥—ã:
  - `save(int $feedId, RawItem $item)` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
  - `getByContentHash(string $hash)` - –ø–æ–∏—Å–∫ –ø–æ —Ö–µ—à—É
  - `exists(string $hash)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
  - `markAsPublished(int $itemId)` - –ø–æ–º–µ—Ç–∫–∞ –∫–∞–∫ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π
  - `getUnpublished(int $feedId, int $limit)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–µ–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö
  - `getStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –Ω–æ–≤–æ—Å—Ç—è–º

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**
```sql
CREATE TABLE `rss2tlg_items` (
    `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
    `feed_id` INT UNSIGNED NOT NULL,
    `content_hash` VARCHAR(32) NOT NULL,
    `guid` VARCHAR(512) NULL,
    `title` VARCHAR(512) NOT NULL,
    `link` VARCHAR(1024) NOT NULL,
    `description` TEXT NULL,
    `content` MEDIUMTEXT NULL,
    `pub_date` DATETIME NULL,
    `author` VARCHAR(255) NULL,
    `categories` JSON NULL,
    `enclosures` JSON NULL,
    `is_published` TINYINT(1) NOT NULL DEFAULT 0,
    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    UNIQUE KEY `idx_content_hash` (`content_hash`),
    KEY `idx_feed_id` (`feed_id`),
    KEY `idx_is_published` (`is_published`),
    KEY `idx_pub_date` (`pub_date`),
    KEY `idx_feed_published` (`feed_id`, `is_published`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### `PublicationRepository.php`
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π –≤ Telegram:
- –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `rss2tlg_publications` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ–≤ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞, –∫—É–¥–∞, –∫–∞–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- –ú–µ—Ç–æ–¥—ã:
  - `record(int $itemId, int $feedId, string $type, string $destId, int $messageId)` - –∑–∞–ø–∏—Å—å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
  - `getByItemId(int $itemId)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π –Ω–æ–≤–æ—Å—Ç–∏
  - `getStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**
```sql
CREATE TABLE `rss2tlg_publications` (
    `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
    `item_id` INT UNSIGNED NOT NULL,
    `feed_id` INT UNSIGNED NOT NULL,
    `destination_type` ENUM('bot', 'channel') NOT NULL,
    `destination_id` VARCHAR(255) NOT NULL,
    `message_id` INT UNSIGNED NOT NULL,
    `published_at` DATETIME NOT NULL,
    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    KEY `idx_item_id` (`item_id`),
    KEY `idx_feed_id` (`feed_id`),
    KEY `idx_destination` (`destination_type`, `destination_id`),
    KEY `idx_published_at` (`published_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### –£–ª—É—á—à–µ–Ω `FeedStateRepository.php`
- –£–∂–µ –∏–º–µ–ª –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `rss2tlg_feed_state`
- –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤: ETag, Last-Modified, backoff

---

### 2. –°–æ–∑–¥–∞–Ω Production —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

**–§–∞–π–ª:** `test_rss2tlg_production.php`

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (MySQL, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏)
- üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- üì• –°–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ 5 RSS –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (Conditional GET)
- üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- üì§ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Telegram –∫–∞–Ω–∞–ª
- üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –±–æ—Ç
- üé® –¶–≤–µ—Ç–Ω–æ–π –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

**–≠—Ç–∞–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (MySQL, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –ë–î)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
3. –ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è - —Å–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ 5 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
4. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π –ø–æ—Ä—Ü–∏–∏ (–ø–æ 2 –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
5. –í—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
6. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤—Ç–æ—Ä–æ–π –ø–æ—Ä—Ü–∏–∏
7. –ò—Ç–æ–≥–æ–≤–∞—è –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ RSS –ª–µ–Ω—Ç—ã
1. ‚úÖ **–†–ò–ê –ù–æ–≤–æ—Å—Ç–∏** - https://ria.ru/export/rss2/index.xml
2. ‚úÖ **–í–µ–¥–æ–º–æ—Å—Ç–∏ (–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)** - https://www.vedomosti.ru/rss/rubric/technology.xml
3. ‚úÖ **Lenta.ru (–¢–æ–ø 7)** - http://lenta.ru/rss/top7
4. ‚úÖ **Ars Technica (AI)** - https://arstechnica.com/ai/feed
5. ‚úÖ **TechCrunch (Startups)** - https://techcrunch.com/startups/feed

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```
‚è± –û–±—â–µ–µ –≤—Ä–µ–º—è: 41.751 —Å–µ–∫
üíæ –ü–∞–º—è—Ç—å: 10 MB (diff: 8 MB)
‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 100% (0 –æ—à–∏–±–æ–∫)
```

### –°–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π
```
–ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è:
  –ü–æ–ª—É—á–µ–Ω–æ: 96 –Ω–æ–≤–æ—Å—Ç–µ–π
  –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î: 96 –Ω–æ–≤–æ—Å—Ç–µ–π (100% —É—Å–ø–µ—Ö)
  
  –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
  - –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏: 20 –Ω–æ–≤–æ—Å—Ç–µ–π
  - –í–µ–¥–æ–º–æ—Å—Ç–∏ (–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏): 20 –Ω–æ–≤–æ—Å—Ç–µ–π
  - Lenta.ru (–¢–æ–ø 7): 16 –Ω–æ–≤–æ—Å—Ç–µ–π
  - Ars Technica (AI): 20 –Ω–æ–≤–æ—Å—Ç–µ–π
  - TechCrunch (Startups): 20 –Ω–æ–≤–æ—Å—Ç–µ–π

–í—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è):
  304 Not Modified: 4 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (80%)
  200 OK: 1 –∏—Å—Ç–æ—á–Ω–∏–∫ (–æ–±–Ω–æ–≤–∏–ª—Å—è)
  –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: 20 –Ω–æ–≤–æ—Å—Ç–µ–π
  
‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Conditional GET —Ä–∞–±–æ—Ç–∞–µ—Ç!
‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ content_hash —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

### –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Telegram
```
–ö–∞–Ω–∞–ª: @kompasDaily

–ü–µ—Ä–≤–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: 10 –Ω–æ–≤–æ—Å—Ç–µ–π (–ø–æ 2 –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
–í—Ç–æ—Ä–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: 10 –Ω–æ–≤–æ—Å—Ç–µ–π (–µ—â–µ –ø–æ 2 –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)

–ò—Ç–æ–≥–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: 20 –Ω–æ–≤–æ—Å—Ç–µ–π
–ü–µ—Ä–≤–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: 2025-11-02 19:14:44
–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è: 2025-11-02 19:15:17
–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏: 500ms
```

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ –ë–î
```sql
SELECT feed_id, url, last_status, error_count FROM rss2tlg_feed_state;
```
| feed_id | URL | last_status | error_count |
|---------|-----|-------------|-------------|
| 1 | –†–ò–ê –ù–æ–≤–æ—Å—Ç–∏ | 200 | 0 |
| 2 | –í–µ–¥–æ–º–æ—Å—Ç–∏ | 304 | 0 |
| 3 | Lenta.ru | 304 | 0 |
| 4 | Ars Technica | 304 | 0 |
| 5 | TechCrunch | 304 | 0 |

### –ù–æ–≤–æ—Å—Ç–∏ –≤ –ë–î
```sql
SELECT feed_id, COUNT(*) as total, SUM(is_published) as published 
FROM rss2tlg_items GROUP BY feed_id;
```
| feed_id | total | published |
|---------|-------|-----------|
| 1 | 20 | 4 |
| 2 | 20 | 4 |
| 3 | 16 | 4 |
| 4 | 20 | 4 |
| 5 | 20 | 4 |

**–ò—Ç–æ–≥–æ:** 96 –Ω–æ–≤–æ—Å—Ç–µ–π, 20 –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ, 76 –≤ –æ—á–µ—Ä–µ–¥–∏

### –ñ—É—Ä–Ω–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–π
```sql
SELECT destination_type, destination_id, COUNT(*) as total 
FROM rss2tlg_publications 
GROUP BY destination_type, destination_id;
```
| destination_type | destination_id | total |
|------------------|----------------|-------|
| channel | @kompasDaily | 20 |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ FetchRunner

```
fetch_total: 10        # –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤
fetch_200: 2           # –£—Å–ø–µ—à–Ω—ã—Ö (200 OK)
fetch_304: 8           # Not Modified (304)
fetch_errors: 0        # –û—à–∏–±–∫–∏ (0%)
parse_errors: 0        # –û—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ (0%)
items_parsed: 40       # –≠–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–æ
```

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:** 80% (8 –∏–∑ 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–µ—Ä–Ω—É–ª–∏ 304 Not Modified)

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª:** `/logs/rss2tlg_test_2025-11-02.log` (38 KB)

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
- ‚úÖ –í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Å –¥–µ—Ç–∞–ª—è–º–∏ (URL, —Å—Ç–∞—Ç—É—Å, –≤—Ä–µ–º—è, —Ä–∞–∑–º–µ—Ä)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ RSS –ª–µ–Ω—Ç (SimplePie)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π –≤ –ë–î
- ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Telegram
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Ñ–æ—Ä–º–∞—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π:**
```
2025-11-02T19:13:45+00:00 INFO –ù–∞—á–∞–ª–æ fetch –∏—Å—Ç–æ—á–Ω–∏–∫–∞ {"feed_id":1,"url":"https://ria.ru/..."}
2025-11-02T19:13:45+00:00 INFO HTTP –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω [GET] –∫–æ–¥ 200 {"duration":2.257,"body_size":351888}
2025-11-02T19:13:45+00:00 INFO –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–µ—Ä–Ω—É–ª –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (200) {"feed_id":1,"body_size":351888}
2025-11-02T19:13:45+00:00 INFO –õ–µ–Ω—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–∞ {"feed_id":1,"items_count":20}
2025-11-02T19:13:45+00:00 DEBUG –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ {"feed_id":1,"last_status":200}
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã RawItem
**–ü—Ä–æ–±–ª–µ–º–∞:** ItemRepository –æ–±—Ä–∞—â–∞–ª—Å—è –∫ `$item->description` –∏ `$item->author`, –Ω–æ –≤ RawItem —ç—Ç–∏ —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –∏–Ω–∞—á–µ.

**–†–µ—à–µ–Ω–∏–µ:** 
- `description` ‚Üí `summary`
- `author` ‚Üí `authors[0]` (–º–∞—Å—Å–∏–≤)
- `enclosures` ‚Üí `enclosure` (–æ–±—ä–µ–∫—Ç)

### 2. TelegramAPI –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ç—Ä–µ–±—É–µ—Ç Http –∫–ª–∏–µ–Ω—Ç, –Ω–æ –≤ —Ç–µ—Å—Ç–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–≤–∞—Ç—å Http –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π TelegramAPI:
```php
$http = new Http(['timeout' => 30]);
$bot = new TelegramAPI(TELEGRAM_BOT_TOKEN, $http);
```

### 3. sendMessage –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –æ–∂–∏–¥–∞–ª –º–∞—Å—Å–∏–≤ —Å `['result']['message_id']`, –Ω–æ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç Message.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ:
```php
$messageObj = $bot->sendMessage(...);
$messageId = $messageObj->messageId;
```

### 4. Logger –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `log_file`, –Ω–æ Logger —Ç—Ä–µ–±—É–µ—Ç `directory`.

**–†–µ—à–µ–Ω–∏–µ:**
```php
new Logger([
    'directory' => LOG_DIR,
    'file_name' => 'rss2tlg_test_' . date('Y-m-d') . '.log',
]);
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`src/Rss2Tlg/ItemRepository.php`** (334 —Å—Ç—Ä–æ–∫–∏)
   - –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π —Å –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã
   
2. **`src/Rss2Tlg/PublicationRepository.php`** (221 —Å—Ç—Ä–æ–∫–∞)
   - –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –∂—É—Ä–Ω–∞–ª–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π —Å –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã
   
3. **`test_rss2tlg_production.php`** (712 —Å—Ç—Ä–æ–∫)
   - Production —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç —Å –ø–æ–ª–Ω—ã–º –æ—Ö–≤–∞—Ç–æ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
   
4. **`RSS2TLG_PRODUCTION_TEST_REPORT.md`** (–¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç)
   - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   
5. **`RSS2TLG_AUTO_TABLES_SUMMARY.md`** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
   - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- ‚úÖ **–ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü:** –í—Å–µ 3 —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã:** UNIQUE –Ω–∞ content_hash, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ feed_id, is_published, pub_date
- ‚úÖ **Charset:** utf8mb4_unicode_ci –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Unicode (—ç–º–æ–¥–∑–∏, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
- ‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** UNIQUE –∏–Ω–¥–µ–∫—Å –Ω–∞ content_hash –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 96 –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ 5 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, 20 –ø—É–±–ª–∏–∫–∞—Ü–∏–π, 0 –æ—à–∏–±–æ–∫
- ‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** 80% –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–µ—Ä–Ω—É–ª–∏ 304 Not Modified
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–ª–Ω–æ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **Telegram:** –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ –∫–∞–Ω–∞–ª –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –±–æ—Ç —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ production

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production:

1. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –ë–î
2. ‚úÖ –ù–∞–¥–µ–∂–Ω—ã–π —Å–±–æ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ RSS/Atom –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
3. ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Conditional GET
4. ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (UNIQUE –∏–Ω–¥–µ–∫—Å)
5. ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Telegram –∫–∞–Ω–∞–ª
6. ‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
7. ‚úÖ 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è production
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `rss2tlg_feed_state`
- –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ `/logs/`

---

**–î–∞—Ç–∞:** 2025-11-02  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **COMPLETED**  
**–ê–≤—Ç–æ—Ä:** CTO.new AI Agent
