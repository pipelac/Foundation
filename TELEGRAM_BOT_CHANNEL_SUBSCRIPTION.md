# –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã –¥–ª—è Telegram Bot

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–µ Telegram –∫–∞–Ω–∞–ª—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ Telegram –∫–∞–Ω–∞–ª—ã —á–µ—Ä–µ–∑ API –º–µ—Ç–æ–¥ `getChatMember`
- ‚úÖ –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:
  - **ALL** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –í–°–ï –∫–∞–Ω–∞–ª—ã –∏–∑ —Å–ø–∏—Å–∫–∞
  - **ANY** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω —Ö–æ—Ç—è –±—ã –Ω–∞ –û–î–ò–ù –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞
  - **EXACT** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–∞–Ω–∞–ª
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ (AccessControl)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ

## –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. ChatMember Entity

**–§–∞–π–ª:** `src/TelegramBot/Entities/ChatMember.php`

–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞—Ç—É—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç–µ/–∫–∞–Ω–∞–ª–µ.

**–°—Ç–∞—Ç—É—Å—ã:**
- `creator` - —Å–æ–∑–¥–∞—Ç–µ–ª—å –∫–∞–Ω–∞–ª–∞/–≥—Ä—É–ø–ø—ã
- `administrator` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- `member` - —É—á–∞—Å—Ç–Ω–∏–∫
- `restricted` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω
- `left` - –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç
- `kicked` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
```php
$chatMember->isSubscribed();  // true –µ—Å–ª–∏ creator/administrator/member
$chatMember->isAdmin();       // true –µ—Å–ª–∏ creator/administrator
$chatMember->hasLeft();       // true –µ—Å–ª–∏ left
$chatMember->isKicked();      // true –µ—Å–ª–∏ kicked
```

### 2. TelegramAPI::getChatMember()

**–§–∞–π–ª:** `src/TelegramBot/Core/TelegramAPI.php`

–ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–ª–µ–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–∞–Ω–∞–ª–µ/–≥—Ä—É–ø–ø–µ.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```php
$chatMember = $api->getChatMember('@channel_username', $userId);

echo "–°—Ç–∞—Ç—É—Å: {$chatMember->status}\n";
echo "–ü–æ–¥–ø–∏—Å–∞–Ω: " . ($chatMember->isSubscribed() ? '–î–∞' : '–ù–µ—Ç') . "\n";
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ –∫–∞–Ω–∞–ª
- –ö–∞–Ω–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º –∏–ª–∏ –±–æ—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø

### 3. ChannelSubscriptionChecker

**–§–∞–π–ª:** `src/TelegramBot/Core/ChannelSubscriptionChecker.php`

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```php
$config = [
    'enabled' => true,
    'mode' => 'any',  // 'all', 'any', –∏–ª–∏ 'exact'
    'channels' => [
        '@channel1',
        '@channel2',
    ],
    'cache_ttl' => 300,  // 5 –º–∏–Ω—É—Ç
    'access_denied_message' => '–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª –¥–ª—è –¥–æ—Å—Ç—É–ø–∞',
];

$checker = new ChannelSubscriptionChecker($api, $config, $logger);
```

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
```php
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
$isSubscribed = $checker->checkSubscription($userId);

// –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
$details = $checker->getSubscriptionDetails($userId);
// ['@channel1' => true, '@channel2' => false]

// –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
$checker->clearCache($userId);

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
$channels = $checker->getChannels();

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
$list = $checker->formatChannelsList();
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AccessControl

**–§–∞–π–ª:** `src/TelegramBot/Core/AccessControl.php`

AccessControl —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã.

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```php
// –ü–µ—Ä–µ–¥–∞–π—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä TelegramAPI –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
$accessControl = new AccessControl(
    'config/telegram_bot_access_control.json',
    $logger,
    $api  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
);
```

**–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
```php
// –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
$accessControl->isSubscriptionCheckEnabled();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ ChannelSubscriptionChecker
$checker = $accessControl->getSubscriptionChecker();

// –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö
$details = $accessControl->getUserSubscriptionDetails($userId);

// –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
$accessControl->clearSubscriptionCache($userId);
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### telegram_bot_access_control.json

–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Å–µ–∫—Ü–∏—è `channel_subscription`:

```json
{
    "enabled": true,
    "users_file": "config/telegram_bot_users.json",
    "roles_file": "config/telegram_bot_roles.json",
    "default_role": "default",
    "access_denied_message": "–£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.",
    "channel_subscription": {
        "enabled": true,
        "mode": "any",
        "channels": [
            "@kompasDaily"
        ],
        "cache_ttl": 300,
        "access_denied_message": "‚õî –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª."
    }
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã channel_subscription:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `enabled` | boolean | –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ |
| `mode` | string | –†–µ–∂–∏–º: `all`, `any`, `exact` |
| `channels` | array | –°–ø–∏—Å–æ–∫ username –∫–∞–Ω–∞–ª–æ–≤ (—Å @ –∏–ª–∏ –±–µ–∑) |
| `cache_ttl` | int | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö |
| `access_denied_message` | string | –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ |

## –†–µ–∂–∏–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### MODE_ALL - –í—Å–µ –∫–∞–Ω–∞–ª—ã

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ **–í–°–ï** –∫–∞–Ω–∞–ª—ã –∏–∑ —Å–ø–∏—Å–∫–∞.

```json
{
    "mode": "all",
    "channels": ["@channel1", "@channel2", "@channel3"]
}
```

–î–æ—Å—Ç—É–ø –±—É–¥–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –≤—Å–µ —Ç—Ä–∏ –∫–∞–Ω–∞–ª–∞.

### MODE_ANY - –•–æ—Ç—è –±—ã –æ–¥–∏–Ω

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω —Ö–æ—Ç—è –±—ã –Ω–∞ **–û–î–ò–ù** –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞.

```json
{
    "mode": "any",
    "channels": ["@channel1", "@channel2", "@channel3"]
}
```

–î–æ—Å—Ç—É–ø –±—É–¥–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω —Ö–æ—Ç—è –±—ã –Ω–∞ –æ–¥–∏–Ω –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.

### MODE_EXACT - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–∞–Ω–∞–ª

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–∞–Ω–∞–ª (–ø–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ).

```json
{
    "mode": "exact",
    "channels": ["@main_channel"]
}
```

–î–æ—Å—Ç—É–ø –±—É–¥–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```php
use App\Component\TelegramBot\Core\TelegramAPI;
use App\Component\TelegramBot\Core\AccessControl;
use App\Component\TelegramBot\Core\AccessControlMiddleware;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
$api = new TelegramAPI($botToken, $http, $logger);
$accessControl = new AccessControl(
    'config/telegram_bot_access_control.json',
    $logger,
    $api  // –í–∞–∂–Ω–æ: –ø–µ—Ä–µ–¥–∞–µ–º API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
);

$middleware = new AccessControlMiddleware($accessControl, $api, $logger);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏
if (!$middleware->checkAndNotify($message, '/start')) {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–∫–∏
    return;
}

// –ö–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
$api->sendMessage($chatId, "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!");
```

### –ü—Ä–∏–º–µ—Ä 2: –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏

```php
// –ü–æ–ª—É—á–∞–µ–º checker
$checker = $accessControl->getSubscriptionChecker();

if ($checker !== null && $checker->isEnabled()) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É
    $isSubscribed = $checker->checkSubscription($userId);
    
    if (!$isSubscribed) {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω
        $channels = $checker->formatChannelsList();
        $api->sendMessage($chatId, "–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∫–∞–Ω–∞–ª—ã:\n{$channels}");
        return;
    }
}
```

### –ü—Ä–∏–º–µ—Ä 3: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö

```php
// –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
$details = $accessControl->getUserSubscriptionDetails($userId);

if ($details !== null) {
    $response = "–í–∞—à–∏ –ø–æ–¥–ø–∏—Å–∫–∏:\n";
    
    foreach ($details as $channel => $subscribed) {
        $icon = $subscribed ? "‚úì" : "‚úó";
        $response .= "{$icon} {$channel}\n";
    }
    
    $api->sendMessage($chatId, $response);
}
```

### –ü—Ä–∏–º–µ—Ä 4: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

```php
$textHandler->handleCommand($update, 'status', function($message) use ($api, $accessControl) {
    $userId = $message->from->id;
    
    if (!$accessControl->isSubscriptionCheckEnabled()) {
        $api->sendMessage($message->chat->id, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞");
        return;
    }
    
    $checker = $accessControl->getSubscriptionChecker();
    $details = $checker->getSubscriptionDetails($userId);
    
    $response = "üìä –í–∞—à —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏:\n\n";
    
    foreach ($details as $channel => $subscribed) {
        $status = $subscribed ? "‚úÖ –ü–æ–¥–ø–∏—Å–∞–Ω" : "‚ùå –ù–µ –ø–æ–¥–ø–∏—Å–∞–Ω";
        $response .= "{$channel}: {$status}\n";
    }
    
    $mode = $checker->getMode();
    $response .= "\nüìå –†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏: {$mode}";
    
    $api->sendMessage($message->chat->id, $response);
});
```

## –†–∞–±–æ—Ç–∞ —Å –∫–µ—à–µ–º

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Telegram API.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –∫–µ—à–∞

```json
{
    "cache_ttl": 300  // 5 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
}
```

### –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞

```php
// –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
$accessControl->clearSubscriptionCache($userId);

// –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
$accessControl->clearSubscriptionCache(null);
```

### –ö–æ–≥–¥–∞ –æ—á–∏—â–∞—Ç—å –∫–µ—à

- –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏/–æ—Ç–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç –∫–∞–Ω–∞–ª–∞
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞–Ω–∞–ª–æ–≤
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞: –ë–æ—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞

```
API Error: Bad Request: CHAT_ADMIN_REQUIRED
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ –∫–∞–Ω–∞–ª.

### –û—à–∏–±–∫–∞: –ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω

```
API Error: Bad Request: CHAT_NOT_FOUND
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å username –∫–∞–Ω–∞–ª–∞ (—Å @ –≤ –Ω–∞—á–∞–ª–µ).

### –û—à–∏–±–∫–∞: API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ AccessControl

```
AccessControlException: –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä TelegramAPI –≤ AccessControl.
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–¥–∞–π—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä TelegramAPI –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ AccessControl:
```php
$accessControl = new AccessControl($configPath, $logger, $api);
```

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ä–æ–ª—è–º–∏

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ** –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π:

1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª—ã
2. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ - –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ
3. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ—à–ª–∞ - –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ä–æ–ª–∏

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞:
- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –†–æ–ª–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–î–æ–±–∞–≤–ª—è–π—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º** —Ç–æ–ª—å–∫–æ –≤ —Ç–µ –∫–∞–Ω–∞–ª—ã, –≥–¥–µ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã** –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ cache_ttl** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–£–≤–µ–ª–∏—á—å—Ç–µ cache_ttl** –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-600 —Å–µ–∫—É–Ω–¥)
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º ANY** –µ—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –æ–¥–∏–Ω –∏–∑ –∫–∞–Ω–∞–ª–æ–≤
3. **–û—á–∏—â–∞–π—Ç–µ –∫–µ—à –≤—ã–±–æ—Ä–æ—á–Ω–æ** (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç

1. **–£–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** –≤ access_denied_message
2. **–ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤** –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ–± –æ—Ç–∫–∞–∑–µ
3. **–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞** –ø–æ–¥–ø–∏—Å–∫–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∂–∏–º Polling:

```bash
php examples/telegram_bot_polling_example.php
```

–ò–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```php
$polling->startPolling(function($update) use ($api, $accessMiddleware) {
    if ($update->isMessage() && $update->message->text === '/start') {
        if (!$accessMiddleware->checkAndNotify($update->message, '/start')) {
            return;
        }
        
        $api->sendMessage(
            $update->message->chat->id,
            "–í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª!"
        );
    }
});
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- GitHub Issues
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Telegram Bot API: https://core.telegram.org/bots/api

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2024  
**–ê–≤—Ç–æ—Ä:** PHP Telegram Bot Toolkit
