# üöÄ UTM Module - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

## üìã –ß—Ç–æ —ç—Ç–æ?

**UTM Module** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π PHP 8.1+ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∏–ª–ª–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π UTM5.  
–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ PHP 5.6 –∫–æ–¥–∞ –ø–æ–¥ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üè¶ Account API
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–∏—Ü–µ–≤—ã—Ö —Å—á–µ—Ç–∞—Ö
- –ë–∞–ª–∞–Ω—Å –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
- –¢–µ–∫—É—â–∏–µ –∏ —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã
- –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ —Å —Ü–µ–Ω–∞–º–∏
- –ì—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### üõ†Ô∏è Utils API
- –í–∞–ª–∏–¥–∞—Ü–∏—è (email, —Ç–µ–ª–µ—Ñ–æ–Ω, IP, –ø–æ–¥—Å–µ—Ç—å)
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ, –≤—Ä–µ–º—è, –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–ª–æ–≤)
- –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è (rus ‚Üî lat –ø–æ –ì–û–°–¢)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è (—Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –ø–∞—Ä–æ–ª–∏)
- –†–∞–±–æ—Ç–∞ —Å –º–∞—Å—Å–∏–≤–∞–º–∏ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (3 —à–∞–≥–∞)

### 1Ô∏è‚É£ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
cp Config/utm_example.json Config/utm.json
nano Config/utm.json  # –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ —Å–≤–æ—é –ë–î UTM5
```

### 2Ô∏è‚É£ –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥
```php
<?php

use App\Config\ConfigLoader;
use App\Component\{Logger, MySQL};
use App\Component\UTM\{Account, Utils};

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
$config = ConfigLoader::load(__DIR__ . '/Config/utm.json');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
$logger = new Logger($config['logger']);
$db = new MySQL($config['database'], $logger);
$account = new Account($db, $logger);

// –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
$balance = $account->getBalance(123);
echo "–ë–∞–ª–∞–Ω—Å: {$balance}\n";

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
$phone = Utils::validateMobileNumber('+7 909 123-45-67');
echo "–¢–µ–ª–µ—Ñ–æ–Ω: {$phone}\n"; // 79091234567
```

### 3Ô∏è‚É£ –ó–∞–ø—É—Å—Ç–∏—Ç–µ
```bash
php your_script.php
```

## üìö –ì–¥–µ –Ω–∞–π—Ç–∏ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏?

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **docs/UTM_MODULE.md** - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (16 KB)
- **src/UTM/README.md** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ FAQ
- **README.md** - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ

### –ü—Ä–∏–º–µ—Ä—ã
- **examples/utm_account_example.php** - –ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä
- **Config/utm_example.json** - –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –¢–µ—Å—Ç—ã
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å unit —Ç–µ—Å—Ç—ã
php tests/test_utm_utils.php
```

## üî• –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–∞–±–æ—Ç–∞ —Å –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏

```php
// –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—á–µ—Ç–µ
$info = $account->getAccountInfo(123);
echo "–ë–∞–ª–∞–Ω—Å: {$info['balance']}\n";
echo "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω: " . ($info['is_blocked'] ? '–î–∞' : '–ù–µ—Ç') . "\n";

// –ë–∞–ª–∞–Ω—Å –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
$balance1 = $account->getBalance(123); // "1234.56(500)—Ä."
$balance2 = $account->getBalance(123, 'balance + credit'); // "1734.56"
$balance3 = $account->getBalance(123, 'array'); // ['balance' => 1234.56, 'credit' => 500]

// –¢–µ–∫—É—â–∏–µ —Ç–∞—Ä–∏—Ñ—ã
$tariffs = $account->getCurrentTariff(123, 'array');
foreach ($tariffs as $id => $name) {
    echo "–¢–∞—Ä–∏—Ñ ID {$id}: {$name}\n";
}

// –£—Å–ª—É–≥–∏ —Å —Ü–µ–Ω–∞–º–∏
$services = $account->getServices(123, 'array');
foreach ($services as $id => $info) {
    echo "{$info['name']}: {$info['cost']} —Ä—É–±. (–∫–æ–ª-–≤–æ: {$info['count']})\n";
}
```

### –†–∞–±–æ—Ç–∞ —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏

```php
// –í–∞–ª–∏–¥–∞—Ü–∏—è
$isValid = Utils::isValidEmail('test@example.com'); // true
$phone = Utils::validateMobileNumber('+7 909 123-45-67'); // "79091234567"
$ip = Utils::validateIp('192.168.1.1'); // "192.168.1.1"
$inRange = Utils::isIpInRange('192.168.1.100', '192.168.1.0/24'); // true

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
$rounded = Utils::doRound(1234.5678, 2); // "1234.57"
$time = Utils::min2hour(90, true); // "1 —á–∞—Å 30 –º–∏–Ω—É—Ç"
$word = Utils::numWord(5, ['–¥–µ–Ω—å', '–¥–Ω—è', '–¥–Ω–µ–π']); // "5 –¥–Ω–µ–π"

// –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è
$lat = Utils::rus2lat('–ü—Ä–∏–≤–µ—Ç'); // "Privet"
$rus = Utils::lat2rus('Privet'); // "–ü—Ä–∏–≤–µ—Ç"

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
$string = Utils::generateString(10); // "aB3x9Km2pQ"
$password = Utils::generatePassword(8); // "12847593"

// –ü–∞—Ä—Å–∏–Ω–≥ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
$numbers = Utils::parseNumbers('1,3-5,7,10-12'); // [1,3,4,5,7,10,11,12]
```

## üéÅ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ API

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –°—Ç–∞—Ä—ã–π API (PHP 5.6) | –ù–æ–≤—ã–π API (PHP 8.1+) |
|----------------|---------------------|----------------------|
| **–¢–∏–ø–∏–∑–∞—Ü–∏—è** | ‚ùå –ù–µ—Ç | ‚úÖ –°—Ç—Ä–æ–≥–∞—è |
| **–û—à–∏–±–∫–∏** | ‚ùå –ú–∞—Å—Å–∏–≤—ã status/error | ‚úÖ –ò—Å–∫–ª—é—á–µ–Ω–∏—è |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚ùå –†—É—á–Ω–æ–µ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | ‚ùå INI —Ñ–∞–π–ª—ã | ‚úÖ JSON |
| **–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞** | ‚ùå –†—É—á–Ω–æ–π include | ‚úÖ PSR-4 Composer |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ‚ùå –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã | ‚úÖ DI |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚úÖ 34 KB |
| **–¢–µ—Å—Ç—ã** | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç | ‚úÖ 12 unit —Ç–µ—Å—Ç–æ–≤ |
| **–ö–æ–¥** | ‚ùå 3100 —Å—Ç—Ä–æ–∫ | ‚úÖ 1253 —Å—Ç—Ä–æ–∫–∏ (-60%) |

## ‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- PHP 8.1+
- MySQL 5.5+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 5.7+)
- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è: PDO, mbstring, bcmath

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
‚ö†Ô∏è **–ú–æ–¥—É–ª—å –ù–ï —Å–æ–≤–º–µ—Å—Ç–∏–º —Å–æ —Å—Ç–∞—Ä—ã–º API**  
–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —Å–æ–≥–ª–∞—Å–Ω–æ `docs/UTM_MODULE.md`

### –ú–∏–≥—Ä–∞—Ü–∏—è
```php
// –ë—ã–ª–æ (PHP 5.6)
$result = $account->getBalanceByAccount($id);
if ($result['status'] == 'OK') {
    echo $result['result'];
}

// –°—Ç–∞–ª–æ (PHP 8.1+)
try {
    $balance = $account->getBalance($id);
    echo $balance;
} catch (AccountException $e) {
    echo "–û—à–∏–±–∫–∞: " . $e->getMessage();
}
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Telegram –±–æ—Ç–µ:

```php
use App\Component\TelegramBot\Core\TelegramAPI;
use App\Component\UTM\Account;

$messageHandler->on('text', function($update) use ($account, $api) {
    if ($update->message->text === '/balance') {
        $chatId = $update->message->chat->id;
        $accountId = getUserAccountId($chatId);
        
        try {
            $balance = $account->getBalance($accountId);
            $api->sendMessage($chatId, "üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: {$balance}");
        } catch (AccountException $e) {
            $api->sendMessage($chatId, "‚ùå –û—à–∏–±–∫–∞: " . $e->getMessage());
        }
    }
});
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –í–æ–ø—Ä–æ—Å—ã?
1. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ **docs/UTM_MODULE.md** - —Ç–∞–º –µ—Å—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ 90% –≤–æ–ø—Ä–æ—Å–æ–≤
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ **examples/utm_account_example.php** - —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ **tests/test_utm_utils.php** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º—ã?
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `Config/utm.json`
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ë–î UTM5 –¥–æ—Å—Ç—É–ø–Ω–∞

–í—Å–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º INFO/WARNING/ERROR/CRITICAL.

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
1. ‚úÖ –ò–∑—É—á–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã
3. ‚¨ú –ù–∞–ø–∏—à–∏—Ç–µ unit —Ç–µ—Å—Ç—ã –¥–ª—è Account
4. ‚¨ú –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î

### –î–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å–≤—è–∑–∏
1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ UTM5
3. ‚¨ú –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å Telegram –±–æ—Ç–æ–º
4. ‚¨ú –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üì¶ –§–∞–π–ª—ã –º–æ–¥—É–ª—è

```
src/UTM/
‚îú‚îÄ‚îÄ Account.php              # API –¥–ª—è –ª–∏—Ü–µ–≤—ã—Ö —Å—á–µ—Ç–æ–≤ (625 —Å—Ç—Ä–æ–∫)
‚îî‚îÄ‚îÄ Utils.php                # –£—Ç–∏–ª–∏—Ç—ã (608 —Å—Ç—Ä–æ–∫)

src/Exception/UTM/
‚îú‚îÄ‚îÄ AccountException.php
‚îî‚îÄ‚îÄ UtilsValidationException.php

docs/
‚îî‚îÄ‚îÄ UTM_MODULE.md           # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (16 KB)

examples/
‚îî‚îÄ‚îÄ utm_account_example.php # –†–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä (6.5 KB)

tests/
‚îî‚îÄ‚îÄ test_utm_utils.php      # Unit —Ç–µ—Å—Ç—ã (12 —Ç–µ—Å—Ç–æ–≤)

Config/
‚îî‚îÄ‚îÄ utm_example.json        # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ PRODUCTION READY  
**–¢–µ—Å—Ç—ã:** 12/12 passed ‚úÖ  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ü–æ–ª–Ω–∞—è ‚úÖ  
**–ü—Ä–∏–º–µ—Ä—ã:** –ï—Å—Ç—å ‚úÖ

---

**üöÄ –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production!**

–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ:
- üìñ **docs/UTM_MODULE.md** - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- üìù **UTM_CHANGELOG.md** - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- üìä **UTM_MIGRATION_SUMMARY.md** - –æ—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏
