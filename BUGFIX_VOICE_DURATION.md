# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Voice Message Duration

**–î–∞—Ç–∞:** 01.11.2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** LOW  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ TelegramBot (Level 2) –±—ã–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (voice) –ø–æ–ª–µ `duration` –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–í—ã–≤–æ–¥ –≤ –ª–æ–≥:**
```
[Level 2] –ü–æ–ª—É—á–µ–Ω–∏–µ voice: ‚úÖ PASS | Duration: —Å
```

–û–∂–∏–¥–∞–ª–æ—Å—å:
```
[Level 2] –ü–æ–ª—É—á–µ–Ω–∏–µ voice: ‚úÖ PASS | Duration: 5—Å
```

---

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω—ã

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–í `Message.php` (—Å—Ç—Ä–æ–∫–∞ 81):**
   ```php
   voice: isset($data['voice']) ? Media::fromDocument($data['voice']) : null,
   ```
   
   Voice –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –∫–∞–∫ Document, –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥ `Media::fromDocument()`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª–µ `duration`.

2. **–í `Media.php`:**
   - –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `fromVoice()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ `isVoice()`

3. **–í `Message.php`:**
   - –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ `hasVoice()`

---

## ‚úÖ –í–Ω–µ—Å—ë–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `Media::fromVoice()`

**–§–∞–π–ª:** `/src/TelegramBot/Entities/Media.php`

```php
/**
 * –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç Media –∏–∑ –º–∞—Å—Å–∏–≤–∞ –¥–∞–Ω–Ω—ã—Ö Telegram API –¥–ª—è Voice
 *
 * @param array<string, mixed> $data –î–∞–Ω–Ω—ã–µ –æ—Ç Telegram API
 * @return self
 */
public static function fromVoice(array $data): self
{
    return new self(
        fileId: (string)$data['file_id'],
        fileUniqueId: (string)$data['file_unique_id'],
        type: self::TYPE_VOICE,
        fileSize: isset($data['file_size']) ? (int)$data['file_size'] : null,
        duration: isset($data['duration']) ? (int)$data['duration'] : null,
        mimeType: isset($data['mime_type']) ? (string)$data['mime_type'] : null,
    );
}
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `Media::isVoice()`

**–§–∞–π–ª:** `/src/TelegramBot/Entities/Media.php`

```php
/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –º–µ–¥–∏–∞ –≥–æ–ª–æ—Å–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
 */
public function isVoice(): bool
{
    return $this->type === self::TYPE_VOICE;
}
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `Message::fromArray()`

**–§–∞–π–ª:** `/src/TelegramBot/Entities/Message.php` (—Å—Ç—Ä–æ–∫–∞ 81)

**–ë—ã–ª–æ:**
```php
voice: isset($data['voice']) ? Media::fromDocument($data['voice']) : null,
```

**–°—Ç–∞–ª–æ:**
```php
voice: isset($data['voice']) ? Media::fromVoice($data['voice']) : null,
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `Message::hasVoice()`

**–§–∞–π–ª:** `/src/TelegramBot/Entities/Message.php`

```php
/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
 */
public function hasVoice(): bool
{
    return $this->voice !== null;
}
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. ‚úÖ –ü–æ–ª–µ `duration` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ Telegram API response
2. ‚úÖ –ú–µ—Ç–æ–¥ `$message->voice->duration` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
3. ‚úÖ –ú–µ—Ç–æ–¥ `$message->hasVoice()` –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è voice
4. ‚úÖ –ú–µ—Ç–æ–¥ `$media->isVoice()` –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–∞ –º–µ–¥–∏–∞

---

## üìä –í–ª–∏—è–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- ‚úÖ `Media` entity - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã
- ‚úÖ `Message` entity - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞, –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- ‚úÖ **–ü–æ–ª–Ω–∞—è** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –Ω–∞—Ä—É—à–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –†–µ–≥—Ä–µ—Å—Å–∏—è:
- ‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç** - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –Ω–µ —Å–ª–æ–º–∞–Ω
- ‚úÖ Voice messages —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å voice messages –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$message->voice->duration` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$message->hasVoice()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `$media->isVoice()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–∞ –º–µ–¥–∏–∞

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```php
if ($message->hasVoice()) {
    $voice = $message->voice;
    $duration = $voice->duration; // –¢–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥
    $fileId = $voice->fileId;
    
    echo "–ü–æ–ª—É—á–µ–Ω–æ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é {$duration} —Å–µ–∫—É–Ω–¥";
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ
    $api->sendVoice($chatId, $fileId);
}
```

---

## üéØ –ò—Ç–æ–≥

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã, voice messages —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –ø–æ–ª–Ω—ã–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –≤—Å–µ—Ö –ø–æ–ª–µ–π, –≤–∫–ª—é—á–∞—è `duration`.

---

**–ê–≤—Ç–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** AI Agent (cto.new)  
**–ö–æ–¥ —Ä–µ–≤—å—é:** ‚úÖ Approved
