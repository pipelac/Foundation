# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–• –ò –£–¢–û–ß–ù–ï–ù–ò–Ø–•

**–î–∞—Ç–∞:** 2025-11-04  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í–ù–ï–°–ï–ù–´

---

## üìã –û–°–ù–û–í–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. ‚úÖ –£—Ç–æ—á–Ω–µ–Ω–∏–µ –æ –ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –æ—Ç—á–µ—Ç–µ –±—ã–ª–æ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –º–æ–¥–µ–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å $0.000000  
**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:** –í–°–ï 3 –ú–û–î–ï–õ–ò –ü–õ–ê–¢–ù–´–ï!

#### –ü–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ (—É–∫–∞–∑–∞–Ω—ã –≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö):

| –ú–æ–¥–µ–ª—å | Prompt ($/1M —Ç–æ–∫–µ–Ω–æ–≤) | Completion ($/1M —Ç–æ–∫–µ–Ω–æ–≤) | –°—Ç–∞—Ç—É—Å |
|--------|----------------------|---------------------------|--------|
| **deepseek/deepseek-chat-v3.1** | $0.14 | $0.28 | üí∞ –ü–õ–ê–¢–ù–ê–Ø |
| **qwen/qwen3-235b-a22b-thinking-2507** | $1.00 | $5.00 | üí∞ –ü–õ–ê–¢–ù–ê–Ø |
| **qwen/qwen3-30b-a3b-thinking-2507** | $0.50 | $2.50 | üí∞ –ü–õ–ê–¢–ù–ê–Ø |

**–ò—Å—Ç–æ—á–Ω–∏–∫:** [OpenRouter Pricing](https://openrouter.ai/docs/models)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –æ—Ç—á–µ—Ç—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
- –í —Ç–µ—Å—Ç–æ–≤–æ–º —Å–∫—Ä–∏–ø—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –ø–ª–∞—Ç–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π

---

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ text2textWithMetrics –≤ OpenRouter

**–§–∞–π–ª:** `/home/engine/project/src/OpenRouter.class.php`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
```php
/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
 *
 * @return array<string, mixed> –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏:
 *                              - content (string): –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
 *                              - usage (array): –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–∞—Ö
 *                              - model (string): –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
 *                              - id (string): ID –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
 */
public function text2textWithMetrics(string $model, string $prompt, array $options = []): array
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `content` - —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
- `usage` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–∫–µ–Ω–∞—Ö:
  - `prompt_tokens` - —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–º–ø—Ç–∞
  - `completion_tokens` - —Ç–æ–∫–µ–Ω—ã –æ—Ç–≤–µ—Ç–∞  
  - `total_tokens` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  - `cached_tokens` - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
- `model` - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- `id` - ID –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç OpenRouter

---

### 3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω AIAnalysisService –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫

**–§–∞–π–ª:** `/home/engine/project/src/Rss2Tlg/AIAnalysisService.php`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ API –æ—Ç–≤–µ—Ç–∞:
```php
private ?array $lastApiResponse = null;
```

2. –ú–µ—Ç–æ–¥ `sendRequestToOpenRouter` –æ–±–Ω–æ–≤–ª–µ–Ω:
```php
// –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
$fullResponse = $this->openRouter->text2textWithMetrics($model, $prompt, $options);

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫
$this->lastApiResponse = $fullResponse;

return $fullResponse['content'];
```

3. –û–±–Ω–æ–≤–ª–µ–Ω `extractTokensUsed()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
```php
private function extractTokensUsed(string $response): ?int
{
    if ($this->lastApiResponse === null) {
        return null;
    }

    $usage = $this->lastApiResponse['usage'] ?? null;
    if ($usage === null) {
        return null;
    }

    return (int)($usage['total_tokens'] ?? 0);
}
```

4. –û–±–Ω–æ–≤–ª–µ–Ω `wasCacheHit()`:
```php
private function wasCacheHit(string $response): bool
{
    if ($this->lastApiResponse === null) {
        return false;
    }

    $usage = $this->lastApiResponse['usage'] ?? [];
    return isset($usage['cached_tokens']) && $usage['cached_tokens'] > 0;
}
```

5. –î–æ–±–∞–≤–ª–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫:
```php
public function getLastApiMetrics(): ?array
{
    return $this->lastApiResponse;
}
```

---

### 4. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫

**–§–∞–π–ª:** `/home/engine/project/tests/Rss2Tlg/rss_ai_tlg_v3_test.php`

**–î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:**

#### A) –°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞:
```php
echo "  ‚Ä¢ –°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞: {$analysis['translation_status']}\n";
```

#### B) –ö–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞:
```php
if ($translationQualityScore !== null) {
    echo "  ‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞: {$translationQualityScore}/100\n";
}
```

#### C) –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤:
```php
$apiMetrics = $aiAnalysisService->getLastApiMetrics();

if ($apiMetrics !== null && isset($apiMetrics['usage'])) {
    $usage = $apiMetrics['usage'];
    $promptTokens = (int)($usage['prompt_tokens'] ?? 0);
    $completionTokens = (int)($usage['completion_tokens'] ?? 0);
    $cachedTokens = (int)($usage['cached_tokens'] ?? 0);
    
    echo "  ‚Ä¢ –ü—Ä–æ–º–ø—Ç —Ç–æ–∫–µ–Ω–æ–≤: {$promptTokens}\n";
    echo "  ‚Ä¢ –û—Ç–≤–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤: {$completionTokens}\n";
    if ($cachedTokens > 0) {
        echo "  ‚Ä¢ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤: {$cachedTokens}\n";
    }
}
```

#### D) –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π:
```php
// –¢–∞—Ä–∏—Ñ—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π (–≤ USD –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤)
$modelPricing = [
    'deepseek/deepseek-chat-v3.1' => ['prompt' => 0.14, 'completion' => 0.28],
    'qwen/qwen3-235b-a22b-thinking-2507' => ['prompt' => 1.00, 'completion' => 5.00],
    'qwen/qwen3-30b-a3b-thinking-2507' => ['prompt' => 0.50, 'completion' => 2.50],
];

if (isset($modelPricing[$modelUsed])) {
    $pricing = $modelPricing[$modelUsed];
    $promptCost = ($promptTokens / 1000000) * $pricing['prompt'];
    $completionCost = ($completionTokens / 1000000) * $pricing['completion'];
    $totalCost = $promptCost + $completionCost;
    
    echo "  ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–º–ø—Ç–∞: $" . number_format($promptCost, 6) . "\n";
    echo "  ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞: $" . number_format($completionCost, 6) . "\n";
    echo "  ‚Ä¢ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $" . number_format($totalCost, 6) . "\n";
}
```

#### E) –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞:
```php
if (isset($analysisData['translation_quality'])) {
    $translationQuality = $analysisData['translation_quality'];
    echo "  ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞:\n";
    echo "    - –¢–æ—á–Ω–æ—Å—Ç—å: " . ($translationQuality['accuracy_score'] ?? 'N/A') . "/100\n";
    echo "    - –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: " . ($translationQuality['readability_score'] ?? 'N/A') . "/100\n";
    echo "    - –ü–æ–ª–Ω–æ—Ç–∞: " . ($translationQuality['completeness_score'] ?? 'N/A') . "/100\n";
    echo "    - –û–±—â–∏–π –±–∞–ª–ª: " . ($translationQuality['overall_score'] ?? 'N/A') . "/100\n";
}
```

#### F) –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –¥–ª—è OpenRouterMetrics:
```php
$aiRequestMetrics[] = [
    'model_used' => $modelUsed,
    'tokens' => [
        'prompt_tokens' => $promptTokens,
        'completion_tokens' => $completionTokens,
        'total_tokens' => $tokensUsed,
        'cached_tokens' => $cachedTokens,
    ],
    'cost' => [
        'prompt_cost' => $promptCost,
        'completion_cost' => $completionCost,
        'total_cost' => $totalCost,
    ],
    'cache' => [
        'hit_rate' => $cachedTokens > 0 ? round(($cachedTokens / $tokensUsed) * 100, 2) : 0.0,
        'hits' => $cacheHit ? 1 : 0,
        'misses' => $cacheHit ? 0 : 1,
        'calculated_hit_rate' => $cachedTokens > 0 ? round(($cachedTokens / $tokensUsed) * 100, 2) : 0.0,
    ],
    'timing' => [
        'queue_time_ms' => 0,
        'processing_time_ms' => $processingTimeMs,
    ],
    'generation_id' => $apiMetrics['id'] ?? null,
    'translation_quality_score' => $translationQualityScore,
];
```

---

## üöß –ü–†–û–ë–õ–ï–ú–ê –° –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï–ú

### API –ö–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω

**–û—à–∏–±–∫–∞ OpenRouter:**
```
{
  "error": {
    "message": "User not found.",
    "code": 401
  }
}
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π API –∫–ª—é—á `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` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –ø–ª–∞—Ç–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ - 401 –æ—à–∏–±–∫–∞
- ‚úÖ –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ - 401 –æ—à–∏–±–∫–∞
- ‚úÖ –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞ - User not found

**–í—ã–≤–æ–¥:** API –∫–ª—é—á —É—Å—Ç–∞—Ä–µ–ª, –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–µ–Ω

---

## üí∞ –†–ê–°–ß–ï–¢ –°–¢–û–ò–ú–û–°–¢–ò (–ü–†–ò–ú–ï–†)

### –î–ª—è deepseek/deepseek-chat-v3.1

–ï—Å–ª–∏ –±—ã –∞–Ω–∞–ª–∏–∑ 10 –Ω–æ–≤–æ—Å—Ç–µ–π –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ —Å —ç—Ç–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–º–ø—Ç: ~3000 —Ç–æ–∫–µ–Ω–æ–≤
- –°—Ä–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç: ~600 —Ç–æ–∫–µ–Ω–æ–≤
- –í—Å–µ–≥–æ –Ω–∞ –Ω–æ–≤–æ—Å—Ç—å: ~3600 —Ç–æ–∫–µ–Ω–æ–≤

**–†–∞—Å—á–µ—Ç:**
```
–ü—Ä–æ–º–ø—Ç: (3000 / 1,000,000) √ó $0.14 = $0.00042 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å
–û—Ç–≤–µ—Ç: (600 / 1,000,000) √ó $0.28 = $0.000168 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å
–ò–¢–û–ì–û: $0.000588 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å

10 –Ω–æ–≤–æ—Å—Ç–µ–π: $0.00588 (~$0.006)
```

### –î–ª—è qwen/qwen3-235b-a22b-thinking-2507

**–†–∞—Å—á–µ—Ç:**
```
–ü—Ä–æ–º–ø—Ç: (3000 / 1,000,000) √ó $1.00 = $0.003 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å
–û—Ç–≤–µ—Ç: (600 / 1,000,000) √ó $5.00 = $0.003 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å
–ò–¢–û–ì–û: $0.006 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å

10 –Ω–æ–≤–æ—Å—Ç–µ–π: $0.06
```

### –î–ª—è qwen/qwen3-30b-a3b-thinking-2507

**–†–∞—Å—á–µ—Ç:**
```
–ü—Ä–æ–º–ø—Ç: (3000 / 1,000,000) √ó $0.50 = $0.0015 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å
–û—Ç–≤–µ—Ç: (600 / 1,000,000) √ó $2.50 = $0.0015 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å
–ò–¢–û–ì–û: $0.003 –∑–∞ –Ω–æ–≤–æ—Å—Ç—å

10 –Ω–æ–≤–æ—Å—Ç–µ–π: $0.03
```

---

## üìä –ü–†–ò–ú–ï–† –í–´–í–û–î–ê –° –ú–ï–¢–†–ò–ö–ê–ú–ò (–ï–°–õ–ò –ë–´ API –†–ê–ë–û–¢–ê–õ)

```
[123] –ê–Ω–∞–ª–∏–∑: –¢—Ä–∞–º–ø –æ–±—ä—è–≤–∏–ª –æ –Ω–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ...
  ‚úì –£—Å–ø–µ—Ö –∑–∞ 15234.56 –º—Å
  ‚Ä¢ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: Politics
  ‚Ä¢ –í–∞–∂–Ω–æ—Å—Ç—å: 8/20
  ‚Ä¢ –Ø–∑—ã–∫: en
  ‚Ä¢ –°—Ç–∞—Ç—É—Å –ø–µ—Ä–µ–≤–æ–¥–∞: translated
  ‚Ä¢ –¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 3542
  ‚Ä¢ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 15234 –º—Å
  ‚Ä¢ –ö–µ—à –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω: –ù–µ—Ç
  ‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–≤–æ–¥–∞: 87/100
  ‚Ä¢ –ü—Ä–æ–º–ø—Ç —Ç–æ–∫–µ–Ω–æ–≤: 2934
  ‚Ä¢ –û—Ç–≤–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤: 608
  ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–º–ø—Ç–∞: $0.000411
  ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞: $0.000170
  ‚Ä¢ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $0.000581
  ‚Ä¢ –ú–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞:
    - –¢–æ—á–Ω–æ—Å—Ç—å: 92/100
    - –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å: 85/100
    - –ü–æ–ª–Ω–æ—Ç–∞: 88/100
    - –û–±—â–∏–π –±–∞–ª–ª: 87/100
```

---

## ‚úÖ –ß–¢–û –ì–û–¢–û–í–û

1. ‚úÖ **OpenRouter.class.php** - –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `text2textWithMetrics()`
2. ‚úÖ **AIAnalysisService.php** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∏–∑ OpenRouter
3. ‚úÖ **rss_ai_tlg_v3_test.php** - –ø–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫:
   - –¢–æ–∫–µ–Ω—ã (prompt, completion, total, cached)
   - –°—Ç–æ–∏–º–æ—Å—Ç—å (—Ä–µ–∞–ª—å–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π)
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ (accuracy, readability, completeness, overall)
   - –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞
   - ID –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
4. ‚úÖ **OpenRouterMetrics.class.php** - —É–∂–µ –±—ã–ª –≥–æ—Ç–æ–≤ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
5. ‚úÖ –í—Å–µ –æ—Ç—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤

---

## üéØ –î–õ–Ø –ó–ê–ü–£–°–ö–ê –° –†–ï–ê–õ–¨–ù–´–ú API –ö–õ–Æ–ß–û–ú

1. –ü–æ–ª—É—á–∏—Ç–µ –¥–µ–π—Å—Ç–≤—É—é—â–∏–π API –∫–ª—é—á –æ—Ç [OpenRouter](https://openrouter.ai/keys)
2. –û–±–Ω–æ–≤–∏—Ç–µ –≤ `/config/rss2tlg_test_v3.json`:
```json
{
  "ai_analysis": {
    "api_key": "–í–ê–®_–î–ï–ô–°–¢–í–£–Æ–©–ò–ô_–ö–õ–Æ–ß",
    "default_model": "deepseek/deepseek-chat-v3.1",
    "fallback_models": [
      "qwen/qwen3-235b-a22b-thinking-2507",
      "qwen/qwen3-30b-a3b-thinking-2507"
    ]
  }
}
```
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:
```bash
php tests/Rss2Tlg/rss_ai_tlg_v3_test.php
```

---

## üìù –ò–¢–û–ì–û–í–û–ï –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï

### –ú–æ–¥–µ–ª–∏ –ü–õ–ê–¢–ù–´–ï:
- ‚úÖ **deepseek/deepseek-chat-v3.1** - $0.14/$0.28 (prompt/completion per 1M tokens)
- ‚úÖ **qwen/qwen3-235b-a22b-thinking-2507** - $1.00/$5.00
- ‚úÖ **qwen/qwen3-30b-a3b-thinking-2507** - $0.50/$2.50

### –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è:
- ‚úÖ –í—Å–µ –≤–∏–¥—ã —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –†–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
- ‚úÖ Cache hit rate
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞
- ‚úÖ –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ ID –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### –ö–æ–¥ –≥–æ—Ç–æ–≤:
- ‚úÖ OpenRouter —Ä–∞—Å—à–∏—Ä–µ–Ω
- ‚úÖ AIAnalysisService –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω—ã–π
- ‚úÖ –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ù–µ–¥–µ–π—Å—Ç–≤—É—é—â–∏–π API –∫–ª—é—á –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

---

**–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ —Å –¥–µ–π—Å—Ç–≤—É—é—â–∏–º API –∫–ª—é—á–æ–º!**
